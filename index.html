<!DOCTYPE html>
<html lang="ko">
<head>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2900491622305328"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€í•™ ì…ì‹œì˜ ì‹  : THE FINAL (2027 ì‹¤ì „)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&family=Jua&family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .font-game { font-family: 'Jua', sans-serif; }
        .font-cute { font-family: 'Gaegu', cursive; }
        
        /* Animations */
        .slide-in { animation: slideIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .pop-in { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .bounce-slow { animation: bounce 2s infinite; }
        .shake { animation: shake 0.5s; }
        
        @keyframes slideIn { from { opacity: 0; transform: translateY(50px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes popIn { from { opacity: 0; transform: scale(0.5); } to { opacity: 1; transform: scale(1); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        .university-card:hover { transform: translateY(-4px); box-shadow: 0 15px 30px -10px rgba(0, 0, 0, 0.1); }
        .hidden-section { display: none !important; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .bg-cute-pattern {
            background-color: #fff0f3;
            background-image: radial-gradient(#fbcfe8 2px, transparent 2px), radial-gradient(#bfdbfe 2px, transparent 2px);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
        }
        /* Medical Theme */
        .bg-medical {
            background-color: #f0fdfa; /* Teal-50 */
            background-image: linear-gradient(#ccfbf1 1px, transparent 1px), linear-gradient(90deg, #ccfbf1 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        /* Army Theme */
        .bg-army {
            background-color: #556b2f;
            background-image: repeating-linear-gradient(45deg, #4b5320 25%, transparent 25%, transparent 75%, #4b5320 75%, #4b5320), repeating-linear-gradient(45deg, #4b5320 25%, #556b2f 25%, #556b2f 75%, #4b5320 75%, #4b5320);
            background-position: 0 0, 10px 10px;
            background-size: 20px 20px;
        }
        
        .shadow-cute { box-shadow: 6px 6px 0px 0px rgba(0,0,0, 0.1); }
        .btn-push:active { transform: translateY(4px); box-shadow: none !important; }
        
        /* Killer Question Style */
        .killer-mode { border: 4px solid #ef4444 !important; animation: shake 0.5s; background-color: #fef2f2 !important; }
        
        /* Score Change Badge */
        .score-change { display: inline-block; padding: 4px 8px; border-radius: 8px; font-weight: bold; font-size: 0.9rem; margin-top: 5px; }
        .score-up { background-color: #d1fae5; color: #166534; }
        .score-down { background-color: #fee2e2; color: #991b1b; }
        
        .ai-recommend { animation: pulse 2s infinite; background: linear-gradient(45deg, #6366f1, #8b5cf6); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        
        /* Letter Style */
        .letter-paper {
            background: #fffdf0;
            background-image: linear-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 100% 2em;
            line-height: 2em;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            font-family: 'Gaegu', cursive;
        }

        .filter-btn.active, .j-filter-btn.active {
            background-color: #1e293b;
            color: white;
            transform: scale(1.05);
        }
    </style>
</head>
<body class="text-slate-800 min-h-screen flex flex-col bg-cute-pattern transition-colors duration-500" id="main-body">

    <!-- Header -->
    <header class="bg-white/90 backdrop-blur-md text-slate-800 p-3 sticky top-0 z-50 border-b-4 border-slate-200 transition-colors duration-500" id="main-header">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center gap-2">
            <div class="flex items-center gap-3">
                <h1 class="text-2xl md:text-3xl font-game flex items-center tracking-wider cursor-pointer drop-shadow-sm hover:scale-105 transition" onclick="window.resetGame('full')">
                    <span class="text-3xl mr-2">ğŸ“</span>ëŒ€í•™ ì…ì‹œì˜ ì‹  : THE FINAL
                </h1>
                <!-- ëª…ì˜ˆì˜ ì „ë‹¹ íƒ­ ë²„íŠ¼ ì¶”ê°€ -->
                <button onclick="window.openHallOfFameModal()" class="bg-gradient-to-r from-yellow-300 to-yellow-500 text-slate-900 px-3 py-1.5 rounded-full font-bold font-game shadow-md hover:scale-105 transition flex items-center text-sm md:text-base">
                    <i class="fas fa-globe mr-1.5"></i>ì˜¨ë¼ì¸ ë­í‚¹
                </button>
            </div>
            <div id="status-bar" class="hidden text-xs md:text-sm flex flex-wrap justify-center gap-3 transition-all duration-300 font-bold font-game mt-2 md:mt-0">
                <span class="bg-yellow-100 px-3 py-1 rounded-full border-2 border-yellow-300 text-yellow-700"><i class="fas fa-user mr-1"></i> <span id="display-name"></span></span>
                <span class="bg-blue-100 px-3 py-1 rounded-full border-2 border-blue-300 text-blue-700"><i class="fas fa-graduation-cap mr-1"></i> <span id="display-major"></span></span>
                <span class="bg-green-100 px-3 py-1 rounded-full border-2 border-green-300 text-green-700"><i class="fas fa-book-open mr-1"></i> ë‚´ì‹ : <span id="display-gpa">0.00</span></span>
                <span class="bg-purple-100 px-3 py-1 rounded-full border-2 border-purple-300 text-purple-700"><i class="fas fa-chart-line mr-1"></i> ìˆ˜ëŠ¥: <span id="display-sat">0</span>%</span>
                <span id="combo-badge" class="hidden bg-red-100 px-3 py-1 rounded-full border-2 border-red-400 text-red-600 animate-pulse"></span>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 flex-grow relative flex flex-col justify-center items-center">
        
        <!-- Scene 1: Intro -->
        <section id="scene-intro" class="max-w-lg w-full relative slide-in z-10 mt-6">
            <div class="bg-white p-8 rounded-[3rem] border-4 border-slate-200 shadow-cute text-center relative overflow-hidden">
                <div class="bg-gradient-to-r from-indigo-200 to-purple-200 absolute top-0 left-0 w-full h-8"></div>
                
                <div id="intro-badge" class="mt-6 mb-4 relative inline-block">
                     <div class="w-32 h-32 bg-white rounded-full flex items-center justify-center mx-auto border-4 border-slate-200 shadow-inner">
                        <i class="fas fa-graduation-cap text-6xl text-indigo-600 bounce-slow"></i>
                    </div>
                </div>

                <h1 class="text-4xl font-game text-slate-800 mb-1 tracking-tight drop-shadow-sm" id="game-title">ëŒ€í•™ ì…ì‹œì˜ ì‹ </h1>
                <h2 class="text-2xl font-cute text-slate-500 mb-8" id="game-subtitle">2027 ëŒ€ì… ì‹¤ì „í¸ (Final) ğŸ“š</h2>

                <!-- Penalty Alert Box -->
                <div id="penalty-alert" class="hidden mb-6 p-4 rounded-2xl text-sm font-bold border-2 animate-pulse text-left font-game shadow-md bg-red-50 text-red-600 border-red-200"></div>

                <form id="profile-form" class="space-y-4 text-left font-game">
                    <div class="grid grid-cols-2 gap-3">
                        <div class="group">
                            <label class="block text-sm text-slate-400 mb-1 ml-2">ì´ë¦„</label>
                            <input type="text" id="input-name" class="w-full bg-slate-50 border-2 border-slate-200 p-3 rounded-2xl focus:border-indigo-400 outline-none text-center text-lg shadow-sm" placeholder="ê¹€ìˆ˜í—˜" required>
                        </div>
                        <div class="group">
                            <label class="block text-sm text-slate-400 mb-1 ml-2">ì¶œì‹  ê³ êµ</label>
                            <input type="text" id="input-school" class="w-full bg-slate-50 border-2 border-slate-200 p-3 rounded-2xl focus:border-indigo-400 outline-none text-center text-lg shadow-sm" placeholder="OOê³ " required>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                         <div class="group">
                            <label class="block text-sm text-slate-400 mb-1 ml-2">ê³„ì—´ ì„ íƒ</label>
                            <select id="input-track" class="w-full bg-slate-50 border-2 border-slate-200 p-3 rounded-2xl focus:border-indigo-400 outline-none text-center text-lg shadow-sm" onchange="toggleMajorInput()">
                                <option value="ì¸ë¬¸">ì¸ë¬¸ê³„ì—´ ğŸ“š</option>
                                <option value="ìì—°">ìì—°ê³„ì—´ ğŸ”¬</option>
                                <option value="ì˜í•™">ì˜í•™ê³„ì—´ ğŸ©º</option>
                                <option value="ì˜ˆì²´ëŠ¥">ì˜ˆì²´ëŠ¥ ğŸ¨</option>
                            </select>
                        </div>
                        <div class="group">
                            <label class="block text-sm text-slate-400 mb-1 ml-2">í¬ë§ ì „ê³µ</label>
                            <input type="text" id="input-major" class="w-full bg-slate-50 border-2 border-slate-200 p-3 rounded-2xl focus:border-indigo-400 outline-none text-center text-lg shadow-sm" placeholder="ê²½ì˜í•™ê³¼" required>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm text-slate-400 mb-1 ml-2">ë‚´ì‹  (1.0~9.0)</label>
                            <input type="number" id="input-gpa" step="0.01" min="1.0" max="9.0" class="w-full bg-slate-50 border-2 border-slate-200 p-3 rounded-2xl focus:border-indigo-400 outline-none text-center text-lg shadow-sm" placeholder="1.00" required>
                        </div>
                        <div>
                            <label class="block text-sm text-slate-400 mb-1 ml-2">ëª¨ì˜ê³ ì‚¬ (%)</label>
                            <input type="number" id="input-sat" min="0" max="100" class="w-full bg-slate-50 border-2 border-slate-200 p-3 rounded-2xl focus:border-indigo-400 outline-none text-center text-lg shadow-sm" placeholder="99" required>
                        </div>
                    </div>
                    
                    <div class="group mt-2">
                        <label class="block text-sm text-slate-400 mb-1 ml-2">ì„±ë³„</label>
                        <select id="input-gender" class="w-full bg-slate-50 border-2 border-slate-200 p-3 rounded-2xl focus:border-indigo-400 outline-none text-center text-lg shadow-sm">
                            <option value="M">ë‚¨ì„± ğŸ‘¦</option>
                            <option value="F">ì—¬ì„± ğŸ‘§</option>
                        </select>
                    </div>

                    <button type="submit" id="start-btn" class="w-full bg-slate-800 hover:bg-slate-900 text-white font-black py-4 rounded-2xl shadow-[0_6px_0_#0f172a] active:shadow-none active:translate-y-[6px] transition-all text-xl mt-4 flex justify-center items-center gap-2 btn-push">
                        2027 ëŒ€ì… ì‹œì‘ ğŸš€
                    </button>
                </form>
            </div>
        </section>

        <!-- Scene 2: Quiz -->
        <section id="scene-quiz" class="hidden-section max-w-2xl w-full mx-auto slide-in">
            <div class="bg-white rounded-[2rem] shadow-cute border-4 border-slate-800 overflow-hidden" id="quiz-container">
                <div class="bg-slate-800 p-6 text-white flex justify-between items-center" id="quiz-header">
                    <div>
                        <h3 class="font-bold text-2xl font-game text-yellow-300" id="quiz-title"><i class="fas fa-brain mr-2"></i>ìˆ˜ëŠ¥ ì‹¤ì „ ëª¨ì˜ê³ ì‚¬</h3>
                        <p class="text-sm font-cute text-slate-300">í‰ê°€ì› ê¸°ì¶œ ë³€í˜• (í‚¬ëŸ¬ ë¬¸í•­ í¬í•¨)</p>
                    </div>
                    <span class="text-lg font-black bg-white/20 px-4 py-2 rounded-xl">Q <span id="current-round">1</span>/<span id="total-rounds">5</span></span>
                </div>
                
                <div class="p-8">
                    <div class="mb-8">
                        <span id="quiz-subject" class="inline-block bg-yellow-100 text-yellow-800 border-2 border-yellow-200 text-sm px-3 py-1 rounded-lg mb-3 font-black font-game">Subject</span>
                        <h2 id="quiz-question" class="text-xl font-bold text-slate-800 leading-relaxed break-keep font-sans">ë¬¸ì œ ë¡œë”©ì¤‘...</h2>
                    </div>
                    <div id="quiz-options" class="grid grid-cols-1 gap-3 font-game text-lg"></div>
                </div>
                
                <div id="quiz-feedback" class="hidden bg-slate-50 p-8 border-t-4 border-slate-100 text-center pop-in">
                    <div id="feedback-icon" class="text-6xl mb-4 inline-block bounce-slow"></div>
                    <p id="feedback-text" class="font-bold text-2xl mb-2 text-slate-700 font-game"></p>
                    <div id="feedback-detail" class="mb-6 h-8 text-lg font-bold"></div>
                    <button id="next-quiz-btn" class="bg-slate-800 text-white px-10 py-3 rounded-2xl hover:bg-black font-bold shadow-lg transition transform hover:scale-105 font-game text-xl">ë‹¤ìŒ ë¬¸ì œ <i class="fas fa-arrow-right ml-1"></i></button>
                </div>
            </div>
        </section>

        <!-- Scene 3: Susi Application -->
        <section id="scene-susi" class="hidden-section slide-in w-full max-w-6xl">
            <div class="text-center mb-8">
                <span class="bg-blue-100 text-blue-700 px-4 py-1 rounded-full text-sm font-black mb-2 inline-block font-game border-2 border-blue-200">STEP 1</span>
                <h2 class="text-4xl font-black text-slate-800 font-game">ìˆ˜ì‹œ ì›ì„œ ì ‘ìˆ˜</h2>
                <p class="text-sm text-slate-500 mt-2 font-bold font-game">* <span class="text-blue-600 bg-blue-50 px-1 rounded">AI ì¶”ì²œ</span> ë§ˆí¬ë¥¼ í™•ì¸í•˜ì„¸ìš” (6ì¥ ì œí•œ)</p>
            </div>

            <div class="flex flex-col lg:flex-row gap-6 h-auto lg:h-[600px]">
                <div class="lg:w-2/3 flex flex-col h-[500px] lg:h-full bg-white rounded-[2rem] shadow-lg p-6 border-4 border-slate-100">
                    <div id="susi-filters" class="flex gap-2 mb-4 overflow-x-auto pb-2 flex-shrink-0 scrollbar-hide font-game">
                        <button class="filter-btn active bg-slate-800 text-white px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap transition shadow-md" data-filter="all">ì „ì²´</button>
                        <button class="filter-btn bg-white border-2 border-slate-200 text-slate-500 px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap hover:bg-slate-50 transition" data-filter="medical">ì˜ì•½í•™ê³„ì—´</button>
                        <button class="filter-btn bg-white border-2 border-slate-200 text-slate-500 px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap hover:bg-slate-50 transition" data-filter="sky">SKY</button>
                        <button class="filter-btn bg-white border-2 border-slate-200 text-slate-500 px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap hover:bg-slate-50 transition" data-filter="in_seoul_top">ì¸ì„œìš¸(ìƒ)</button>
                        <button class="filter-btn bg-white border-2 border-slate-200 text-slate-500 px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap hover:bg-slate-50 transition" data-filter="in_seoul_mid">ì¸ì„œìš¸/ìˆ˜ë„ê¶Œ</button>
                        <button class="filter-btn bg-white border-2 border-slate-200 text-slate-500 px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap hover:bg-slate-50 transition" data-filter="metro">ê²½ê¸°/ì¸ì²œ</button>
                        <button class="filter-btn bg-white border-2 border-slate-200 text-slate-500 px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap hover:bg-slate-50 transition" data-filter="jigeoguk">ì§€ê±°êµ­</button>
                        <button class="filter-btn bg-white border-2 border-slate-200 text-slate-500 px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap hover:bg-slate-50 transition" data-filter="local">ì§€ë°©ì‚¬ë¦½</button>
                    </div>
                    <div id="susi-uni-list" class="grid grid-cols-1 md:grid-cols-2 gap-3 overflow-y-auto pr-2 pb-2"></div>
                </div>

                <div class="lg:w-1/3 flex flex-col h-auto lg:h-full bg-white rounded-[2rem] shadow-cute p-6 border-4 border-blue-200 relative">
                    <div class="absolute -top-4 -right-4 bg-red-500 text-white w-10 h-10 rounded-full flex items-center justify-center font-black text-xl shadow-md z-10 bounce-slow" id="susi-badge">0</div>
                    <h3 class="font-bold text-2xl text-slate-800 font-game mb-4 border-b-2 border-dashed border-blue-100 pb-2">ğŸ“‚ ë‚´ ì›ì„œí•¨</h3>
                    <div class="flex-grow overflow-y-auto bg-blue-50 rounded-xl p-3 mb-4 inner-shadow min-h-[150px] lg:min-h-0">
                        <ul id="susi-cart" class="space-y-2 text-sm font-game"></ul>
                    </div>
                    <button id="btn-susi-submit" class="w-full bg-slate-200 text-slate-400 font-black py-4 rounded-xl transition-all shadow-none cursor-not-allowed text-xl font-game" disabled>ëŒ€í•™ì„ ì„ íƒí•˜ì„¸ìš”</button>
                </div>
            </div>
        </section>

        <!-- Scene 4: Exam Intro -->
        <section id="scene-exam-intro" class="hidden-section max-w-lg mx-auto slide-in mt-10 w-full text-center">
            <div class="bg-white p-10 rounded-[3rem] shadow-cute border-4 border-slate-800 relative overflow-hidden">
                <i class="fas fa-file-contract text-7xl text-cyan-500 mb-6 bounce-slow block drop-shadow-md"></i>
                <h2 class="text-4xl font-black text-slate-800 font-game mb-4">ëŒ€í•™ë³„ ê³ ì‚¬</h2>
                <p class="text-slate-500 text-xl mb-8 font-cute">ë§ˆì§€ë§‰ ì—­ì „ì˜ ê¸°íšŒ!<br>ì‹¬ì¸µ ë©´ì ‘ê³¼ ë…¼ìˆ ì—ì„œ ì‹¤ë ¥ì„ ë³´ì—¬ì£¼ì„¸ìš”.</p>
                <button onclick="startActualExams()" class="bg-slate-800 text-white px-12 py-5 rounded-2xl font-black hover:bg-black shadow-[0_6px_0_#334155] active:shadow-none active:translate-y-[6px] transition text-2xl font-game">ì…ì¥í•˜ê¸° ğŸšª</button>
            </div>
        </section>

        <!-- Scene 4-1: Interview Game -->
        <section id="scene-interview" class="hidden-section max-w-2xl mx-auto slide-in mt-10 w-full">
            <div class="bg-white rounded-[2rem] shadow-xl p-8 border-4 border-green-200">
                <div class="text-center mb-6">
                    <span class="bg-green-100 text-green-700 px-4 py-1 rounded-lg text-sm font-bold mb-3 inline-block font-game">í•™ìƒë¶€ ì¢…í•© ë©´ì ‘</span>
                    <h3 class="text-3xl font-bold text-slate-800 font-game">ğŸ’¬ ì‹¬ì¸µ ë©´ì ‘ (4ë‹¨ê³„)</h3>
                    <div class="flex justify-center gap-2 mt-4" id="interview-steps"></div>
                </div>
                <div id="interview-content" class="bg-green-50 p-8 rounded-2xl border-2 border-green-100 font-game text-lg"></div>
            </div>
        </section>

        <!-- Scene 4-2: Essay Game -->
        <section id="scene-essay" class="hidden-section max-w-3xl mx-auto slide-in mt-10 w-full">
            <div class="bg-white rounded-[2rem] shadow-xl p-8 border-4 border-purple-200">
                <div class="text-center mb-8">
                    <span class="bg-purple-100 text-purple-700 px-4 py-1 rounded-lg text-sm font-bold mb-3 inline-block font-game">ë…¼ìˆ ì „í˜•</span>
                    <h3 class="text-3xl font-bold text-slate-800 font-game">âœï¸ ì‹¬ì¸µ ë…¼ìˆ  ê³ ì‚¬</h3>
                    <p class="text-slate-500 mt-2 font-cute">ì œì‹œë¬¸ì„ ì½ê³  ë¬¼ìŒì— ë‹µí•˜ì‹œì˜¤</p>
                    <div class="flex justify-center gap-2 mt-4" id="essay-steps"></div>
                </div>
                <div id="essay-content" class="bg-purple-50 p-8 rounded-2xl border-2 border-purple-100 font-game text-lg"></div>
            </div>
        </section>

        <!-- Scene 4-3: Arts Practical -->
        <section id="scene-practical" class="hidden-section max-w-2xl mx-auto slide-in mt-10 w-full text-center">
            <div class="bg-white rounded-[2rem] shadow-xl p-8 border-4 border-orange-200">
                <div class="text-center mb-6">
                    <span class="bg-orange-100 text-orange-700 px-4 py-1 rounded-lg text-sm font-bold mb-3 inline-block font-game">ì˜ˆì²´ëŠ¥ ì‹¤ê¸°</span>
                    <h3 class="text-3xl font-bold text-slate-800 font-game">âš¡ ìˆœë°œë ¥ í…ŒìŠ¤íŠ¸</h3>
                </div>
                <div id="reaction-area" class="reaction-box reaction-waiting h-64 rounded-3xl flex items-center justify-center text-white text-4xl font-black font-game shadow-inner transform active:scale-95 transition cursor-pointer" onclick="handleReactionClick()">ì¤€ë¹„...</div>
                <button id="practical-next-btn" class="hidden mt-6 bg-slate-800 text-white px-8 py-3 rounded-xl hover:bg-black transition font-game text-xl">ë‹¤ìŒìœ¼ë¡œ</button>
            </div>
        </section>

        <!-- Scene 5: Susi Result -->
        <section id="scene-susi-result" class="hidden-section max-w-6xl mx-auto slide-in w-full">
            <div class="bg-white rounded-[2.5rem] shadow-xl p-10 text-center min-h-[600px] flex flex-col justify-center relative border-8 border-blue-50">
                <h2 class="text-4xl font-black mb-6 text-slate-800 font-game">ğŸ‰ ìˆ˜ì‹œ í•©ê²©ì ë°œí‘œ ğŸ‰</h2>
                <div id="susi-result-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 mb-10"></div>
                <div id="susi-outcome-controls" class="hidden border-t-2 border-dashed border-slate-200 pt-10">
                    <div id="susi-pass-msg" class="hidden">
                        <p class="text-3xl font-bold text-green-600 mb-2 font-game animate-bounce">ì¶•í•˜í•©ë‹ˆë‹¤! í•©ê²©!</p>
                        <!-- ì •ì‹œ ê°•ì œ ê¸ˆì§€ (ìˆ˜ì‹œ ë‚©ì¹˜ êµ¬í˜„) -->
                        <button id="go-to-final-choice-susi" class="bg-slate-800 hover:bg-black text-white font-black py-4 px-12 rounded-2xl shadow-xl font-game text-xl transition hover:scale-105 mt-4">ìµœì¢… ë“±ë¡í•˜ê¸° âœ¨</button>
                    </div>
                    <div id="susi-fail-msg" class="hidden">
                        <p class="text-2xl font-bold text-slate-500 mb-2 font-game">ì•„ì‰½ê²Œë„ ë¶ˆí•©ê²©ì…ë‹ˆë‹¤ ğŸ˜­</p>
                        <button id="go-to-jeongsi" class="bg-blue-500 hover:bg-blue-600 text-white font-black py-4 px-12 rounded-2xl shadow-xl font-game text-xl transition hover:scale-105 mt-4">ì •ì‹œ ë„ì „í•˜ê¸° ğŸ”¥</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Scene 6: Jeongsi Application -->
        <section id="scene-jeongsi" class="hidden-section slide-in w-full max-w-6xl">
            <div class="text-center mb-8">
                <span class="bg-indigo-100 text-indigo-700 px-4 py-1 rounded-full text-sm font-black mb-2 inline-block font-game border-2 border-indigo-200">STEP 2</span>
                <h2 class="text-3xl font-black text-slate-800 font-game">ì •ì‹œ ì›ì„œ ì ‘ìˆ˜</h2>
                <p class="text-slate-500 mt-2 font-bold font-game">ê°€/ë‚˜/ë‹¤êµ° ì´ 3ì¥ ì§€ì›</p>
            </div>
            <div class="flex flex-col lg:flex-row gap-6 h-auto lg:h-[600px]">
                <div class="lg:w-2/3 flex flex-col h-[500px] lg:h-full bg-white rounded-[2rem] shadow-lg p-6 overflow-hidden border-4 border-slate-100">
                    <div id="jeongsi-filters" class="flex gap-2 mb-4 overflow-x-auto pb-2 flex-shrink-0 scrollbar-hide font-game">
                        <button class="j-filter-btn active bg-slate-800 text-white px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap transition shadow-md" data-filter="all">ì „ì²´</button>
                         <button class="j-filter-btn bg-white border-2 border-slate-200 text-slate-500 px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap hover:bg-slate-50 transition" data-filter="medical">ì˜ì•½í•™ê³„ì—´</button>
                        <button class="j-filter-btn bg-white border-2 border-slate-200 text-slate-500 px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap hover:bg-slate-50 transition" data-filter="sky">SKY</button>
                        <button class="j-filter-btn bg-white border-2 border-slate-200 text-slate-500 px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap hover:bg-slate-50 transition" data-filter="in_seoul_top">ì¸ì„œìš¸(ìƒ)</button>
                        <button class="j-filter-btn bg-white border-2 border-slate-200 text-slate-500 px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap hover:bg-slate-50 transition" data-filter="in_seoul_mid">ì¸ì„œìš¸/ìˆ˜ë„ê¶Œ</button>
                        <button class="j-filter-btn bg-white border-2 border-slate-200 text-slate-500 px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap hover:bg-slate-50 transition" data-filter="metro">ê²½ê¸°/ì¸ì²œ</button>
                        <button class="j-filter-btn bg-white border-2 border-slate-200 text-slate-500 px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap hover:bg-slate-50 transition" data-filter="jigeoguk">ì§€ê±°êµ­</button>
                        <button class="j-filter-btn bg-white border-2 border-slate-200 text-slate-500 px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap hover:bg-slate-50 transition" data-filter="local">ì§€ë°©ì‚¬ë¦½</button>
                    </div>
                    <div id="jeongsi-uni-list" class="grid grid-cols-1 md:grid-cols-2 gap-3 overflow-y-auto pr-2 pb-2 h-full"></div>
                </div>
                <div class="lg:w-1/3 flex flex-col h-auto lg:h-full bg-white rounded-[2rem] shadow-cute p-6 border-4 border-indigo-200 relative">
                     <div class="absolute -top-4 -right-4 bg-purple-500 text-white w-10 h-10 rounded-full flex items-center justify-center font-black text-xl shadow-md z-10 bounce-slow" id="jeongsi-badge">0</div>
                     <h3 class="font-bold text-2xl text-slate-800 font-game mb-4 border-b-2 border-dashed border-indigo-100 pb-2">ğŸ“‚ ì •ì‹œ ì›ì„œí•¨</h3>
                    <div class="flex-grow overflow-y-auto bg-indigo-50 rounded-xl p-3 mb-4 inner-shadow min-h-[150px] lg:min-h-0">
                        <ul id="jeongsi-cart" class="space-y-2 text-sm font-game"></ul>
                    </div>
                    <button id="submit-jeongsi" disabled class="w-full bg-slate-200 text-slate-400 font-black py-4 rounded-xl transition-all shadow-none cursor-not-allowed text-xl font-game">ì ‘ìˆ˜í•˜ê¸°</button>
                </div>
            </div>
        </section>

        <!-- Scene 7: Jeongsi Result -->
        <section id="scene-jeongsi-announce" class="hidden-section max-w-3xl mx-auto slide-in text-center mt-10 w-full">
            <div class="bg-white p-12 rounded-[2.5rem] shadow-2xl border-4 border-indigo-100">
                <h2 class="text-4xl font-black text-slate-800 font-game mb-8">ì •ì‹œ í•©ê²©ì ë°œí‘œ</h2>
                <div id="jeongsi-loading" class="flex justify-center mb-10"><i class="fas fa-spinner fa-spin text-6xl text-indigo-300"></i></div>
                <div id="jeongsi-results-container" class="grid gap-4 opacity-0 transition-opacity duration-1000"></div>
                
                <div id="jeongsi-next-controls" class="hidden mt-10">
                    <button id="go-to-final-choice-jeongsi" class="hidden bg-indigo-600 text-white px-10 py-4 rounded-2xl font-bold hover:bg-indigo-700 shadow-xl transition transform hover:scale-105 text-lg font-game">ìµœì¢… ë“±ë¡í•˜ê¸° âœ¨</button>
                    
                    <div id="jeongsi-fail-options" class="hidden">
                        <p class="text-2xl font-bold text-slate-700 mb-6 font-game">ëª¨ë“  ëŒ€í•™ì— ë¶ˆí•©ê²©í–ˆìŠµë‹ˆë‹¤..ğŸ˜­</p>
                        <div class="flex flex-col gap-3 justify-center max-w-md mx-auto font-game">
                            <button onclick="window.resetGame('jaesu')" class="bg-red-400 hover:bg-red-500 text-white px-8 py-4 rounded-2xl font-bold shadow-md transition flex items-center justify-between text-lg">
                                <span>ğŸ”¥ ì¬ìˆ˜í•˜ê¸°</span> <span class="text-sm bg-black/20 px-2 py-1 rounded">ë‚´ì‹  -0.5 / ìˆ˜ëŠ¥ +5ì </span>
                            </button>
                            <button onclick="window.resetGame('gunsu')" class="bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-2xl font-bold shadow-md transition flex items-center justify-between text-lg">
                                <span>ğŸª– êµ°ìˆ˜í•˜ê¸°</span> <span class="text-sm bg-black/20 px-2 py-1 rounded">ë‚´ì‹  -0.7 / í€´ì¦ˆ ê¸°íšŒ 2ë°°</span>
                            </button>
                            <button onclick="window.showEncouragementLetter(false)" class="bg-slate-500 hover:bg-slate-600 text-white px-8 py-4 rounded-2xl font-bold shadow-md transition flex items-center justify-center text-lg">
                                ğŸ’Œ ê²°ê³¼ ìŠ¹ë³µí•˜ê¸° (í¸ì§€ ë³´ê¸°)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Scene 9: Final Selection -->
        <section id="scene-final-select" class="hidden-section max-w-3xl mx-auto slide-in text-center mt-10 w-full">
            <div class="bg-white p-10 rounded-[3rem] shadow-cute border-4 border-blue-200">
                <h2 class="text-4xl font-black text-slate-800 font-game mb-4">ìµœì¢… ëŒ€í•™ ì„ íƒ</h2>
                <div id="final-candidate-list" class="grid gap-4 mb-8 font-game"></div>
            </div>
        </section>

        <!-- Scene 8: Final Certificate -->
        <section id="scene-final" class="hidden-section max-w-3xl mx-auto slide-in text-center mt-10 w-full">
            <div class="bg-white p-10 rounded-[2.5rem] shadow-2xl border-8 border-yellow-200 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-4 bg-yellow-400"></div>
                <i class="fas fa-crown text-8xl text-yellow-400 mb-6 drop-shadow-md mt-6 block bounce-slow"></i>
                <h2 class="text-5xl font-black text-slate-800 mb-2 font-game">ìµœì¢… í•©ê²©ì¦</h2>
                <div id="final-university-display" class="my-10 p-8 bg-slate-50 rounded-3xl border-2 border-slate-100 font-game"></div>
                
                <div class="bg-indigo-50 p-6 rounded-2xl text-left border border-indigo-100 shadow-inner font-game">
                    <h3 class="font-bold text-indigo-800 mb-4 border-b border-indigo-200 pb-2 text-sm"><i class="fas fa-file-invoice mr-2"></i>ìµœì¢… ë¦¬í¬íŠ¸</h3>
                    <div class="grid grid-cols-2 gap-6 text-lg">
                        <div><span class="text-indigo-400 block text-xs mb-1">ì´ë¦„</span> <span class="font-bold final-name text-slate-800"></span></div>
                        <div><span class="text-indigo-400 block text-xs mb-1">ê³ êµ</span> <span class="font-bold text-slate-800 final-school-display"></span></div>
                        <div><span class="text-indigo-400 block text-xs mb-1">ë‚´ì‹ </span> <span class="font-bold text-blue-600 final-gpa-display"></span></div>
                        <div><span class="text-indigo-400 block text-xs mb-1">ìˆ˜ëŠ¥</span> <span class="font-bold text-purple-600 final-sat-display"></span>%</div>
                    </div>
                </div>

                <!-- ì…ì‹œ ì „ëµ í‰ê°€ ì˜ì—­ (ì¶”ê°€) -->
                <div class="bg-yellow-50 p-6 rounded-2xl text-left border border-yellow-200 shadow-inner font-game mt-4 relative overflow-hidden">
                    <h3 class="font-bold text-yellow-800 mb-4 border-b border-yellow-200 pb-2 text-sm"><i class="fas fa-search-chart mr-2"></i>ì…ì‹œ ì „ëµ í‰ê°€</h3>
                    <div class="flex items-center gap-6 z-10 relative">
                        <div id="eval-grade" class="text-6xl font-black text-red-500 drop-shadow-md w-24 text-center">S+</div>
                        <div>
                            <div id="eval-score" class="text-xl font-bold text-slate-800 mb-1">ì…ì‹œ ìŠ¤ì½”ì–´: 100ì </div>
                            <div id="eval-comment" class="text-sm text-slate-600 leading-relaxed">í‰ê°€ ì¤‘...</div>
                        </div>
                    </div>
                    <i class="fas fa-stamp absolute -right-2 -bottom-4 text-8xl text-yellow-200/60 transform -rotate-12 z-0"></i>
                </div>
                
                <div class="mt-8">
                     <button onclick="window.showEncouragementLetter(true)" class="bg-pink-400 hover:bg-pink-500 text-white px-8 py-3 rounded-xl font-game shadow-md text-lg mb-4 w-full">ğŸ’Œ ì„ ìƒë‹˜ì˜ í¸ì§€ ì½ê¸°</button>
                </div>
                <button onclick="location.reload()" class="bg-slate-800 text-white px-12 py-5 rounded-2xl hover:bg-black shadow-xl font-bold transition transform hover:scale-105 mb-4 group font-game text-xl">ì²˜ìŒìœ¼ë¡œ</button>
            </div>
        </section>

        <!-- Scene 10: Letter Ending -->
        <section id="scene-letter" class="hidden-section max-w-2xl mx-auto slide-in mt-10 w-full text-center">
            <div id="letter-content" class="letter-paper p-10 rounded-[2.5rem] relative overflow-hidden text-left font-cute text-2xl text-slate-700 leading-relaxed shadow-2xl">
                <!-- Content injected dynamically -->
            </div>
            
            <div class="mt-12 text-center">
                <button onclick="window.showHallOfFame()" class="bg-indigo-500 text-white px-10 py-4 rounded-2xl font-game hover:bg-indigo-600 shadow-lg text-lg transition hover:scale-105">ëª…ì˜ˆì˜ ì „ë‹¹ ê²°ê³¼ í™•ì¸ ğŸ†</button>
            </div>
        </section>

        <!-- Scene 11: Hall of Fame -->
        <section id="scene-hall-of-fame" class="hidden-section max-w-3xl mx-auto slide-in text-center mt-10 w-full">
            <div class="bg-slate-900 p-10 rounded-[3rem] shadow-2xl border-4 border-yellow-400 relative overflow-hidden text-white">
                <i class="fas fa-trophy text-7xl text-yellow-400 mb-4 bounce-slow block drop-shadow-[0_0_15px_rgba(250,204,21,0.8)]"></i>
                <h2 class="text-4xl font-black text-white font-game mb-2 tracking-widest">ëª…ì˜ˆì˜ ì „ë‹¹</h2>
                <p class="text-yellow-200 font-cute text-xl mb-8">2027í•™ë…„ë„ ëŒ€ì… ìµœì¢… ê²°ê³¼</p>
                
                <div class="bg-slate-800 p-6 rounded-2xl border-2 border-slate-600 mb-8 flex flex-col items-center">
                    <div id="hof-icon" class="text-6xl mb-2">ğŸ‘‘</div>
                    <div id="hof-title" class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-yellow-600 font-game mb-4">ì…ì‹œì˜ ì‹ </div>
                    
                    <div class="w-full grid grid-cols-2 gap-4 text-left bg-slate-700 p-4 rounded-xl font-game text-lg">
                        <div><span class="text-slate-400 block text-xs">í”Œë ˆì´ì–´</span> <span id="hof-name" class="text-white"></span></div>
                        <div><span class="text-slate-400 block text-xs">ìµœì¢… ì§„í•™</span> <span id="hof-uni" class="text-white font-bold"></span></div>
                        <div><span class="text-slate-400 block text-xs">ìµœì¢… ë‚´ì‹ </span> <span id="hof-gpa" class="text-green-400"></span></div>
                        <div><span class="text-slate-400 block text-xs">ìµœì¢… ìˆ˜ëŠ¥</span> <span id="hof-sat" class="text-purple-400"></span>%</div>
                    </div>
                </div>
                
                <p id="hof-comment" class="text-lg text-slate-300 font-cute mb-8 break-keep leading-relaxed"></p>
                
                <button onclick="location.reload()" class="bg-gradient-to-r from-yellow-500 to-orange-500 text-slate-900 px-12 py-4 rounded-2xl hover:from-yellow-400 hover:to-orange-400 shadow-[0_0_20px_rgba(234,179,8,0.4)] font-black transition transform hover:scale-105 text-xl font-game">ìƒˆë¡œìš´ ë„ì „ ì‹œì‘í•˜ê¸° ğŸš€</button>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-slate-100 text-slate-400 text-center p-6 text-xs font-bold font-game">
        <p>Copyright â“’ 2026 <span class="text-cyan-400">NADASHIP</span>. All rights reserved.</p>
    </footer>
    
    <!-- Susi Type Modal -->
    <div id="type-modal" class="fixed inset-0 bg-black/60 hidden z-[60] flex items-center justify-center p-4 backdrop-blur-sm transition-opacity">
        <div class="bg-white rounded-[2rem] shadow-2xl max-w-sm w-full p-8 transform scale-100 transition-transform">
            <div class="text-center mb-6">
                <h3 class="text-3xl font-black text-slate-800 font-game">ì „í˜• ì„ íƒ</h3>
                <p class="text-lg text-slate-500 mt-1 font-cute font-bold" id="modal-uni-name">ëŒ€í•™êµ</p>
                <p class="text-sm text-red-500 mt-2 font-bold bg-red-50 inline-block px-2 py-1 rounded" id="modal-uni-chojeo"></p>
            </div>
            
            <div class="space-y-3 font-game">
                <button class="type-select-btn w-full p-4 border-2 border-slate-100 rounded-2xl hover:border-blue-500 hover:bg-blue-50 transition text-left group bg-white" data-type="êµê³¼">
                    <div>
                        <div class="font-bold text-slate-700 text-lg group-hover:text-blue-600">í•™ìƒë¶€ êµê³¼</div>
                        <div class="text-xs text-slate-400 mt-0.5">ë‚´ì‹  100% + ìµœì €</div>
                    </div>
                    <i class="fas fa-calculator text-slate-300 group-hover:text-blue-500 text-2xl"></i>
                </button>
                <button class="type-select-btn w-full p-4 border-2 border-slate-100 rounded-2xl hover:border-green-500 hover:bg-green-50 transition text-left group bg-white" data-type="ì¢…í•©">
                    <div>
                        <div class="font-bold text-slate-700 text-lg group-hover:text-green-600">í•™ìƒë¶€ ì¢…í•©</div>
                        <div class="text-xs text-slate-400 mt-0.5">ì„œë¥˜ + ì‹¬ì¸µë©´ì ‘(4ë‹¨ê³„)</div>
                    </div>
                    <i class="fas fa-user-tie text-slate-300 group-hover:text-green-500 text-2xl"></i>
                </button>
                <button class="type-select-btn w-full p-4 border-2 border-slate-100 rounded-2xl hover:border-purple-500 hover:bg-purple-50 transition text-left group bg-white" data-type="ë…¼ìˆ ">
                    <div>
                        <div class="font-bold text-slate-700 text-lg group-hover:text-purple-600">ë…¼ìˆ  ì „í˜•</div>
                        <div class="text-xs text-slate-400 mt-0.5">ë‚´ì‹ â†“ + ë…¼ìˆ (2ë¬¸ì œ)</div>
                    </div>
                    <i class="fas fa-pen-nib text-slate-300 group-hover:text-purple-500 text-2xl"></i>
                </button>
            <div class="mt-4 pt-4 border-t border-slate-700 flex justify-center items-center relative">
                <span class="text-slate-400 font-game text-sm"><i class="fas fa-network-wired mr-1"></i>ì „ ì„¸ê³„ í”Œë ˆì´ì–´ë“¤ê³¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê¸°ë¡ì´ ë™ê¸°í™”ë©ë‹ˆë‹¤.</span>
                <span onclick="window.openAdminModal()" class="cursor-pointer text-slate-700 hover:text-slate-500 absolute right-0"><i class="fas fa-user-shield"></i></span>
            </div>
        </div>
    </div>

    <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ ë° ì´ˆê¸°í™” ëª¨ë‹¬ -->
    <div id="admin-modal" class="fixed inset-0 bg-black/80 hidden z-[80] flex items-center justify-center p-4 backdrop-blur-sm transition-opacity">
        <div class="bg-slate-900 rounded-[2rem] shadow-2xl max-w-sm w-full p-8 border-4 border-red-500 relative flex flex-col">
            <button onclick="window.closeAdminModal()" class="absolute top-4 right-5 text-slate-400 hover:text-white text-3xl transition"><i class="fas fa-times"></i></button>
            <h2 class="text-3xl font-black text-red-500 font-game mb-6 text-center">
                <i class="fas fa-lock mr-2"></i>ê´€ë¦¬ì ê¶Œí•œ
            </h2>
            <p class="text-slate-400 text-sm font-game mb-4 text-center">ëª…ì˜ˆì˜ ì „ë‹¹ ì˜¨ë¼ì¸ ë°ì´í„°ë¥¼<br>ëª¨ë‘ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.</p>
            <input type="text" id="admin-id" placeholder="ID" class="w-full bg-slate-800 text-white border-2 border-slate-600 p-3 rounded-xl mb-3 font-game outline-none focus:border-red-500">
            <input type="password" id="admin-pw" placeholder="Password" class="w-full bg-slate-800 text-white border-2 border-slate-600 p-3 rounded-xl mb-6 font-game outline-none focus:border-red-500">
            <button onclick="window.executeAdminClear()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 rounded-xl shadow-lg transition-all font-game text-xl flex items-center justify-center gap-2">
                <i class="fas fa-trash-alt"></i> ì „ì²´ ì´ˆê¸°í™” ì‹¤í–‰
            </button>
        </div>
    </div>

    <!-- Firebase SDK (ES Module Dynamic Import) -->
    <script>
        let firebaseConfig = null;
        let internalAppId = 'default-app-id';
        
        if (typeof __firebase_config !== 'undefined' && __firebase_config) {
            firebaseConfig = JSON.parse(__firebase_config);
            if (typeof __app_id !== 'undefined') internalAppId = __app_id;
        } else {
            // ì£¼ì‹  Firebase í”„ë¡œì íŠ¸ ì„¤ì •ê°’ìœ¼ë¡œ ëŒ€ì²´ ì™„ë£Œ
            firebaseConfig = {
                apiKey: "AIzaSyDIDY-GnCfRlnIfNBr5OH1DibVB3jLUtT8",
                authDomain: "ipsi-s-god.firebaseapp.com",
                projectId: "ipsi-s-god",
                storageBucket: "ipsi-s-god.firebasestorage.app",
                messagingSenderId: "1096252834959",
                appId: "1:1096252834959:web:ce304e6dfd170ad74b5cfa",
                measurementId: "G-LKLF747XCT"
            };
        }

        window.globalHofData = [];
        window.currentUser = null;
        window.db = null;
        window.addDoc = null;
        window.collection = null;
        window.deleteDoc = null; // ì¶”ê°€
        window.doc = null;       // ì¶”ê°€
        window.appId = internalAppId;

        async function initFirebase() {
            try {
                if (!firebaseConfig || !firebaseConfig.projectId) {
                    console.log("Firebase ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤. ë¡œì»¬ ë­í‚¹ ëª¨ë“œë¡œ ì‘ë™í•©ë‹ˆë‹¤.");
                    return;
                }

                const appMod = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js");
                const authMod = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js");
                const fsMod = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js");
                
                window.collection = fsMod.collection;
                window.addDoc = fsMod.addDoc;
                window.deleteDoc = fsMod.deleteDoc; // ì¶”ê°€
                window.doc = fsMod.doc;             // ì¶”ê°€

                const app = appMod.initializeApp(firebaseConfig);
                const auth = authMod.getAuth(app);
                window.db = fsMod.getFirestore(app);

                const doAuth = async () => {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await authMod.signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await authMod.signInAnonymously(auth);
                    }
                };
                await doAuth();

                authMod.onAuthStateChanged(auth, (user) => {
                    window.currentUser = user;
                    if (user && window.db) {
                        const hofRef = fsMod.collection(window.db, 'artifacts', window.appId, 'public', 'data', 'hall_of_fame');
                        fsMod.onSnapshot(hofRef, (snapshot) => {
                            const data = [];
                            snapshot.forEach(doc => data.push({ dbId: doc.id, ...doc.data() }));
                            window.globalHofData = data.sort((a, b) => b.score - a.score || b.timestamp - a.timestamp);
                            
                            const modal = document.getElementById('hof-modal');
                            if(modal && !modal.classList.contains('hidden')) {
                                window.renderHallOfFameList();
                            }
                        }, (error) => {
                            console.error("Firestore Error:", error);
                        });
                    }
                });
            } catch(e) {
                console.error("Firebase ì´ˆê¸°í™” ì—ëŸ¬:", e);
            }
        }
        
        initFirebase();

        // --- Global State ---
        let activeRetryMode = null; 
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        // --- Sound Effects ---
        function playSuccessSound() {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); 
            osc.frequency.exponentialRampToValueAtTime(1046.5, audioCtx.currentTime + 0.1); 
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        }
        function playFailSound() {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(200, audioCtx.currentTime); 
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }

        // --- University Data (Massively Expanded) ---
        const universities = [
             // 1. Medical (Ui-Dae) - Top Tier
            { id: 101, name: "ì„œìš¸ëŒ€ ì˜ì˜ˆê³¼", tier: "medical", cut_h: 1.05, cut_n: 1.05, jeongsi_cut: 99.7, chojeo: 99, gender:'all', logo: "fas fa-user-md", color: "text-slate-900" },
            { id: 102, name: "ì—°ì„¸ëŒ€ ì˜ì˜ˆê³¼", tier: "medical", cut_h: 1.08, cut_n: 1.08, jeongsi_cut: 99.5, chojeo: 99, gender:'all', logo: "fas fa-hospital", color: "text-blue-800" },
            { id: 103, name: "ê°€í†¨ë¦­ëŒ€ ì˜ì˜ˆê³¼", tier: "medical", cut_h: 1.10, cut_n: 1.10, jeongsi_cut: 99.2, chojeo: 98, gender:'all', logo: "fas fa-cross", color: "text-blue-600" },
            { id: 104, name: "ì„±ê· ê´€ëŒ€ ì˜ì˜ˆê³¼", tier: "medical", cut_h: 1.10, cut_n: 1.10, jeongsi_cut: 99.2, chojeo: 98, gender:'all', logo: "fas fa-leaf", color: "text-green-700" },
            { id: 105, name: "ìš¸ì‚°ëŒ€ ì˜ì˜ˆê³¼", tier: "medical", cut_h: 1.12, cut_n: 1.12, jeongsi_cut: 99.0, chojeo: 97, gender:'all', logo: "fas fa-anchor", color: "text-cyan-700" },
            { id: 106, name: "ê³ ë ¤ëŒ€ ì˜ì˜ˆê³¼", tier: "medical", cut_h: 1.15, cut_n: 1.15, jeongsi_cut: 99.0, chojeo: 98, gender:'all', logo: "fas fa-shield-cat", color: "text-red-800" },
            
            // Medical - Mid/Jigeoguk
            { id: 110, name: "ê²½í¬ëŒ€ ì˜ì˜ˆê³¼", tier: "medical", cut_h: 1.20, cut_n: 1.20, jeongsi_cut: 98.5, chojeo: 97, gender:'all', logo: "fas fa-globe", color: "text-red-600" },
            { id: 111, name: "í•œì–‘ëŒ€ ì˜ì˜ˆê³¼", tier: "medical", cut_h: 1.20, cut_n: 1.20, jeongsi_cut: 98.5, chojeo: 97, gender:'all', logo: "fas fa-lion", color: "text-blue-600" },
            { id: 112, name: "ì•„ì£¼ëŒ€ ì˜ì˜ˆê³¼", tier: "medical", cut_h: 1.25, cut_n: 1.25, jeongsi_cut: 98.0, chojeo: 96, gender:'all', logo: "fas fa-user-md", color: "text-blue-800" },
            { id: 113, name: "ê°€ì²œëŒ€ ì˜ì˜ˆê³¼", tier: "medical", cut_h: 1.25, cut_n: 1.25, jeongsi_cut: 98.0, chojeo: 96, gender:'all', logo: "fas fa-wind", color: "text-blue-500" },
            { id: 114, name: "ë¶€ì‚°ëŒ€ ì˜ì˜ˆê³¼", tier: "medical", cut_h: 1.30, cut_n: 1.30, jeongsi_cut: 97.8, chojeo: 96, gender:'all', logo: "fas fa-mountain", color: "text-blue-700" },
            
            // Medical - Private/Lower
            { id: 120, name: "ì„ì§€ëŒ€ ì˜ì˜ˆê³¼", tier: "medical", cut_h: 1.40, cut_n: 1.40, jeongsi_cut: 97.0, chojeo: 95, gender:'all', logo: "fas fa-medkit", color: "text-green-600" },
            { id: 121, name: "ê±´ì–‘ëŒ€ ì˜ì˜ˆê³¼", tier: "medical", cut_h: 1.45, cut_n: 1.45, jeongsi_cut: 96.8, chojeo: 95, gender:'all', logo: "fas fa-heartbeat", color: "text-green-500" },
            { id: 122, name: "ì¡°ì„ ëŒ€ ì˜ì˜ˆê³¼", tier: "medical", cut_h: 1.50, cut_n: 1.50, jeongsi_cut: 96.5, chojeo: 95, gender:'all', logo: "fas fa-ship", color: "text-blue-500" },

            // Dental (Chi-Dae)
            { id: 130, name: "ì„œìš¸ëŒ€ ì¹˜ì˜í•™", tier: "medical", cut_h: 1.20, cut_n: 1.20, jeongsi_cut: 98.0, chojeo: 97, gender:'all', logo: "fas fa-tooth", color: "text-slate-800" },
            { id: 131, name: "ì—°ì„¸ëŒ€ ì¹˜ì˜ì˜ˆ", tier: "medical", cut_h: 1.30, cut_n: 1.30, jeongsi_cut: 97.5, chojeo: 97, gender:'all', logo: "fas fa-tooth", color: "text-blue-700" },
            { id: 132, name: "ê²½í¬ëŒ€ ì¹˜ì˜ì˜ˆ", tier: "medical", cut_h: 1.40, cut_n: 1.40, jeongsi_cut: 97.0, chojeo: 96, gender:'all', logo: "fas fa-tooth", color: "text-red-600" },
            { id: 133, name: "ë‹¨êµ­ëŒ€(ì²œ) ì¹˜ì˜ì˜ˆ", tier: "medical", cut_h: 1.45, cut_n: 1.45, jeongsi_cut: 96.5, chojeo: 96, gender:'all', logo: "fas fa-tooth", color: "text-blue-600" },

            // Korean Med (Han-Ui-Dae)
            { id: 140, name: "ê²½í¬ëŒ€ í•œì˜ì˜ˆ", tier: "medical", cut_h: 1.40, cut_n: 1.40, jeongsi_cut: 97.0, chojeo: 96, gender:'all', logo: "fas fa-mortar-pestle", color: "text-yellow-700" },
            { id: 141, name: "ê°€ì²œëŒ€ í•œì˜ì˜ˆ", tier: "medical", cut_h: 1.50, cut_n: 1.50, jeongsi_cut: 96.5, chojeo: 95, gender:'all', logo: "fas fa-mortar-pestle", color: "text-blue-500" },
            { id: 142, name: "ëŒ€êµ¬í•œì˜ëŒ€", tier: "medical", cut_h: 1.60, cut_n: 1.60, jeongsi_cut: 95.5, chojeo: 95, gender:'all', logo: "fas fa-leaf", color: "text-green-600" },

            // Pharmacy (Yak-Dae)
            { id: 150, name: "ì„œìš¸ëŒ€ ì•½í•™", tier: "medical", cut_h: 1.35, cut_n: 1.35, jeongsi_cut: 96.5, chojeo: 95, gender:'all', logo: "fas fa-capsules", color: "text-slate-800" },
            { id: 151, name: "ì¤‘ì•™ëŒ€ ì•½í•™", tier: "medical", cut_h: 1.45, cut_n: 1.45, jeongsi_cut: 96.0, chojeo: 95, gender:'all', logo: "fas fa-capsules", color: "text-blue-600" },
            { id: 152, name: "ì´í™”ì—¬ëŒ€ ì•½í•™", tier: "medical", cut_h: 1.60, cut_n: 1.60, jeongsi_cut: 95.0, chojeo: 94, gender:'F', logo: "fas fa-capsules", color: "text-green-700" },

            // Vet (Su-Ui-Dae)
            { id: 160, name: "ì„œìš¸ëŒ€ ìˆ˜ì˜ì˜ˆ", tier: "medical", cut_h: 1.30, cut_n: 1.30, jeongsi_cut: 96.5, chojeo: 95, gender:'all', logo: "fas fa-dog", color: "text-slate-800" },
            { id: 161, name: "ê±´êµ­ëŒ€ ìˆ˜ì˜ì˜ˆ", tier: "medical", cut_h: 1.50, cut_n: 1.50, jeongsi_cut: 95.5, chojeo: 95, gender:'all', logo: "fas fa-dog", color: "text-green-600" },

            // 2. SKY 
            { id: 1, name: "ì„œìš¸ëŒ€í•™êµ", tier: "sky", cut_h: 1.20, cut_n: 1.25, jeongsi_cut: 98.5, chojeo: 96, gender:'all', logo: "fas fa-university", color: "text-blue-900" },
            { id: 2, name: "ì—°ì„¸ëŒ€í•™êµ", tier: "sky", cut_h: 1.45, cut_n: 1.50, jeongsi_cut: 97.5, chojeo: 95, gender:'all', logo: "fas fa-eagle", color: "text-blue-700" },
            { id: 3, name: "ê³ ë ¤ëŒ€í•™êµ", tier: "sky", cut_h: 1.55, cut_n: 1.60, jeongsi_cut: 97.0, chojeo: 95, gender:'all', logo: "fas fa-shield-cat", color: "text-red-800" },
            
            // 3. In Seoul Top
            { id: 4, name: "ì„œê°•ëŒ€í•™êµ", tier: "in_seoul_top", cut_h: 1.70, cut_n: 1.75, jeongsi_cut: 94.5, chojeo: 92, gender:'all', logo: "fas fa-star", color: "text-red-600" },
            { id: 5, name: "ì„±ê· ê´€ëŒ€í•™êµ", tier: "in_seoul_top", cut_h: 1.75, cut_n: 1.80, jeongsi_cut: 95.0, chojeo: 92, gender:'all', logo: "fas fa-leaf", color: "text-green-700" },
            { id: 6, name: "í•œì–‘ëŒ€í•™êµ", tier: "in_seoul_top", cut_h: 1.80, cut_n: 1.85, jeongsi_cut: 94.0, chojeo: 92, gender:'all', logo: "fas fa-lion", color: "text-blue-600" },
            { id: 7, name: "ì¤‘ì•™ëŒ€í•™êµ", tier: "in_seoul_top", cut_h: 1.90, cut_n: 1.95, jeongsi_cut: 93.0, chojeo: 90, gender:'all', logo: "fas fa-building-columns", color: "text-blue-500" },
            { id: 8, name: "ê²½í¬ëŒ€í•™êµ", tier: "in_seoul_top", cut_h: 2.00, cut_n: 2.10, jeongsi_cut: 92.0, chojeo: 89, gender:'all', logo: "fas fa-globe", color: "text-red-500" },
            { id: 9, name: "í•œêµ­ì™¸êµ­ì–´ëŒ€", tier: "in_seoul_top", cut_h: 2.20, cut_n: 2.40, jeongsi_cut: 91.0, chojeo: 88, gender:'all', logo: "fas fa-earth-asia", color: "text-cyan-700" },
            { id: 10, name: "ì„œìš¸ì‹œë¦½ëŒ€", tier: "in_seoul_top", cut_h: 2.15, cut_n: 2.25, jeongsi_cut: 91.5, chojeo: 88, gender:'all', logo: "fas fa-city", color: "text-blue-900" },
            { id: 11, name: "ì´í™”ì—¬ìëŒ€", tier: "in_seoul_top", cut_h: 2.00, cut_n: 2.10, jeongsi_cut: 92.5, chojeo: 89, gender:'F', logo: "fas fa-flower", color: "text-green-800" },

            // 4. In Seoul Mid / Major Jigeoguk
            { id: 12, name: "ê±´êµ­ëŒ€í•™êµ", tier: "in_seoul_mid", cut_h: 2.30, cut_n: 2.35, jeongsi_cut: 90.0, chojeo: 87, gender:'all', logo: "fas fa-horse-head", color: "text-green-600" },
            { id: 13, name: "ë™êµ­ëŒ€í•™êµ", tier: "in_seoul_mid", cut_h: 2.40, cut_n: 2.45, jeongsi_cut: 89.0, chojeo: 86, gender:'all', logo: "fas fa-dharmachakra", color: "text-orange-600" },
            { id: 14, name: "í™ìµëŒ€í•™êµ", tier: "in_seoul_mid", cut_h: 2.50, cut_n: 2.55, jeongsi_cut: 88.0, chojeo: 88, gender:'all', logo: "fas fa-palette", color: "text-blue-800" },
            { id: 15, name: "ìˆ™ëª…ì—¬ìëŒ€", tier: "in_seoul_mid", cut_h: 2.45, cut_n: 2.50, jeongsi_cut: 88.5, chojeo: 86, gender:'F', logo: "fas fa-snowflake", color: "text-blue-400" },
            { id: 16, name: "êµ­ë¯¼ëŒ€í•™êµ", tier: "in_seoul_mid", cut_h: 2.60, cut_n: 2.70, jeongsi_cut: 86.0, chojeo: 84, gender:'all', logo: "fas fa-tree", color: "text-green-800" },
            { id: 17, name: "ìˆ­ì‹¤ëŒ€í•™êµ", tier: "in_seoul_mid", cut_h: 2.65, cut_n: 2.75, jeongsi_cut: 86.5, chojeo: 84, gender:'all', logo: "fas fa-church", color: "text-blue-500" },
            { id: 18, name: "ì„¸ì¢…ëŒ€í•™êµ", tier: "in_seoul_mid", cut_h: 2.70, cut_n: 2.80, jeongsi_cut: 85.5, chojeo: 83, gender:'all', logo: "fas fa-chess-king", color: "text-red-700" },
            { id: 19, name: "ë‹¨êµ­ëŒ€í•™êµ", tier: "in_seoul_mid", cut_h: 2.80, cut_n: 2.90, jeongsi_cut: 84.0, chojeo: 82, gender:'all', logo: "fas fa-bear", color: "text-blue-900" },
            { id: 20, name: "ì•„ì£¼ëŒ€í•™êµ", tier: "in_seoul_mid", cut_h: 2.85, cut_n: 2.95, jeongsi_cut: 83.5, chojeo: 81, gender:'all', logo: "fas fa-user-md", color: "text-blue-900" },
            { id: 21, name: "ì¸í•˜ëŒ€í•™êµ", tier: "in_seoul_mid", cut_h: 2.90, cut_n: 3.00, jeongsi_cut: 82.5, chojeo: 80, gender:'all', logo: "fas fa-plane", color: "text-blue-600" },
            { id: 30, name: "ë¶€ì‚°ëŒ€í•™êµ", tier: "jigeoguk", cut_h: 2.90, cut_n: 3.10, jeongsi_cut: 84.0, chojeo: 82, gender:'all', logo: "fas fa-mountain", color: "text-blue-700" },
            { id: 31, name: "ê²½ë¶ëŒ€í•™êµ", tier: "jigeoguk", cut_h: 3.00, cut_n: 3.20, jeongsi_cut: 83.0, chojeo: 81, gender:'all', logo: "fas fa-apple-alt", color: "text-red-700" },

            // 5. Metro & Jigeoguk Mid
            { id: 401, name: "ê´‘ìš´ëŒ€í•™êµ", tier: "metro", cut_h: 3.3, cut_n: 3.4, jeongsi_cut: 80.0, chojeo: 78, gender:'all', logo: "fas fa-lightbulb", color: "text-red-800" },
            { id: 402, name: "ëª…ì§€ëŒ€í•™êµ", tier: "metro", cut_h: 3.4, cut_n: 3.5, jeongsi_cut: 78.0, chojeo: 77, gender:'all', logo: "fas fa-tree", color: "text-blue-900" },
            { id: 403, name: "ìƒëª…ëŒ€í•™êµ", tier: "metro", cut_h: 3.5, cut_n: 3.6, jeongsi_cut: 77.0, chojeo: 76, gender:'all', logo: "fas fa-deer", color: "text-blue-600" },
            { id: 404, name: "ê°€í†¨ë¦­ëŒ€", tier: "metro", cut_h: 3.6, cut_n: 3.7, jeongsi_cut: 76.0, chojeo: 75, gender:'all', logo: "fas fa-cross", color: "text-blue-500" },
            { id: 405, name: "ê°€ì²œëŒ€í•™êµ", tier: "metro", cut_h: 3.5, cut_n: 3.5, jeongsi_cut: 79.0, chojeo: 78, gender:'all', logo: "fas fa-wind", color: "text-blue-400" },
            { id: 32, name: "ì „ë‚¨ëŒ€í•™êµ", tier: "jigeoguk", cut_h: 3.7, cut_n: 3.9, jeongsi_cut: 75.0, chojeo: 74, gender:'all', logo: "fas fa-tree", color: "text-green-700" },
            { id: 33, name: "ì¶©ë‚¨ëŒ€í•™êµ", tier: "jigeoguk", cut_h: 3.6, cut_n: 3.8, jeongsi_cut: 76.0, chojeo: 75, gender:'all', logo: "fas fa-horse", color: "text-blue-800" },
            { id: 34, name: "ì¶©ë¶ëŒ€í•™êµ", tier: "jigeoguk", cut_h: 3.8, cut_n: 4.0, jeongsi_cut: 72.0, chojeo: 0, gender:'all', logo: "fas fa-book", color: "text-red-700" },
            { id: 35, name: "ì „ë¶ëŒ€í•™êµ", tier: "jigeoguk", cut_h: 3.9, cut_n: 4.1, jeongsi_cut: 71.0, chojeo: 0, gender:'all', logo: "fas fa-landmark", color: "text-indigo-800" },
            { id: 36, name: "ê°•ì›ëŒ€í•™êµ", tier: "jigeoguk", cut_h: 4.0, cut_n: 4.2, jeongsi_cut: 70.0, chojeo: 0, gender:'all', logo: "fas fa-mountain", color: "text-green-600" },

            // 6. Local Private & Lower
            { id: 501, name: "ë¶€ê²½ëŒ€í•™êµ", tier: "jigeoguk", cut_h: 4.3, cut_n: 4.5, jeongsi_cut: 68.0, chojeo: 0, gender:'all', logo: "fas fa-fish", color: "text-blue-600" },
            { id: 502, name: "ì˜ë‚¨ëŒ€í•™êµ", tier: "local", cut_h: 4.6, cut_n: 4.8, jeongsi_cut: 65.0, chojeo: 0, gender:'all', logo: "fas fa-book-open", color: "text-blue-700" },
            { id: 503, name: "ë™ì•„ëŒ€í•™êµ", tier: "local", cut_h: 4.7, cut_n: 4.9, jeongsi_cut: 64.0, chojeo: 0, gender:'all', logo: "fas fa-university", color: "text-purple-700" },
            { id: 504, name: "ì¡°ì„ ëŒ€í•™êµ", tier: "local", cut_h: 4.8, cut_n: 5.0, jeongsi_cut: 63.0, chojeo: 0, gender:'all', logo: "fas fa-ship", color: "text-blue-500" },
            { id: 505, name: "ê³„ëª…ëŒ€í•™êµ", tier: "local", cut_h: 4.9, cut_n: 5.1, jeongsi_cut: 62.0, chojeo: 0, gender:'all', logo: "fas fa-music", color: "text-blue-400" }
        ];

        // --- UPGRADED Quiz Data ---
        const quizPool = [
            // Korean History
            { subject: "í•œêµ­ì‚¬(ê·¼í˜„ëŒ€)", q: "ë°•ì •í¬ ì •ë¶€ ì‹œê¸° 3ì„  ê°œí—Œì„ ë°˜ëŒ€í•˜ëŠ” ëª©ì†Œë¦¬ê°€ ì»¤ì§€ë˜ ì¤‘ ë°œìƒí•œ ì‚¬ê±´ì€?", options: ["ë¶€ë§ˆ ë¯¼ì£¼ í•­ìŸ", "6.3 ì‹œìœ„", "ì „íƒœì¼ ë¶„ì‹  ì‚¬ê±´", "3.1 ë¯¼ì£¼ êµ¬êµ­ ì„ ì–¸"], a: 2 },
            { subject: "í•œêµ­ì‚¬(í˜„ëŒ€)", q: "1980ë…„ 5ì›”, ê³„ì—„êµ°ì— ë§ì„œ ì‹œë¯¼êµ°ì´ ì¡°ì§ë˜ê³  ìˆ˜ìŠµ ëŒ€ì±… ìœ„ì›íšŒê°€ í™œë™í–ˆë˜ ë¯¼ì£¼í™” ìš´ë™ì€?", options: ["4.19 í˜ëª…", "5.18 ë¯¼ì£¼í™” ìš´ë™", "6ì›” ë¯¼ì£¼ í•­ìŸ", "ë¶€ë§ˆ í•­ìŸ"], a: 1 },
            { subject: "í•œêµ­ì‚¬(ê³ ëŒ€)", q: "ë¶€ì—¬ì˜ ì œì²œ í–‰ì‚¬ì¸ ì˜ê³ ëŠ” ì–¸ì œ ì—´ë ¸ëŠ”ê°€?", options: ["1ì›”", "5ì›”", "10ì›”", "12ì›”"], a: 3 },
            { subject: "í•œêµ­ì‚¬(ì¡°ì„ )", q: "ì¡°ì„  í›„ê¸° ëŒ€ë™ë²•ì˜ ì‹¤ì‹œ ê²°ê³¼ë¡œ ê°€ì¥ ì ì ˆí•œ ê²ƒì€?", options: ["ê³µì¸ì´ ë“±ì¥í•˜ì˜€ë‹¤.", "ì§€ì£¼ ì „í˜¸ì œê°€ ê°•í™”ë˜ì—ˆë‹¤.", "ê²°ì‘ì´ ë¶€ê³¼ë˜ì—ˆë‹¤.", "ì§ì „ë²•ì´ íì§€ë˜ì—ˆë‹¤."], a: 0 },
            { subject: "í•œêµ­ì‚¬(ê°œí•­ê¸°)", q: "1894ë…„ ë™í•™ ë†ë¯¼ ìš´ë™ ë‹¹ì‹œ ë†ë¯¼êµ°ì´ ì œì‹œí•œ íì • ê°œí˜ì•ˆì— í¬í•¨ë˜ì§€ ì•Šì€ ê²ƒì€?", options: ["ë…¸ë¹„ ë¬¸ì„œ ì†Œê°", "í† ì§€ í‰ê·  ë¶„ì‘", "ì²­ì— ëŒ€í•œ ì¡°ê³µ íì§€", "íƒê´€ì˜¤ë¦¬ ì²˜ë²Œ"], a: 2 },

            // Math
            { subject: "ìˆ˜í•™(ê¸°í•˜)", q: "íƒ€ì›ì˜ ì¥ì¶• ê¸¸ì´ê°€ 10ì´ê³  ë‘ ì´ˆì  ì‚¬ì´ì˜ ê±°ë¦¬ê°€ 8ì¼ ë•Œ, íƒ€ì› ìœ„ì˜ ì  Pì— ëŒ€í•´ ì„ ë¶„ FP + F'Pì˜ ê°’ì€?", options: ["8", "10", "12", "14"], a: 1 }, 
            { subject: "ìˆ˜í•™(í™•í†µ)", q: "ì–´ë–¤ ì‹œí–‰ì—ì„œ ì‚¬ê±´ Aê°€ ì¼ì–´ë‚  í™•ë¥  P(A)=0.4, ì¡°ê±´ë¶€ í™•ë¥  P(B|A)=0.5ì¼ ë•Œ P(Aâˆ©B)ì˜ ê°’ì€?", options: ["0.2", "0.4", "0.5", "0.9"], a: 0 },
            { subject: "ìˆ˜í•™(í‚¬ëŸ¬)", q: "ë¡œê·¸ë°©ì •ì‹ logâ‚‚(x-1) + logâ‚‚(x+2) = 2 ì˜ í•´ xëŠ”?", options: ["2", "3", "4", "5"], a: 0 },
            { subject: "ìˆ˜í•™II(ë¯¸ë¶„)", q: "í•¨ìˆ˜ f(x) = xÂ³ - 3xÂ² + k ê°€ ì„œë¡œ ë‹¤ë¥¸ ì„¸ ì‹¤ê·¼ì„ ê°–ë„ë¡ í•˜ëŠ” ì •ìˆ˜ kì˜ ê°œìˆ˜ëŠ”?", options: ["2", "3", "4", "5"], a: 1 },
            { subject: "ë¯¸ì ë¶„(ê·¹í•œ)", q: "lim(nâ†’âˆ) (2nÂ² + 3n) / (nÂ² - 1) ì˜ ê°’ì€?", options: ["1", "2", "3", "âˆ"], a: 1 },
            { subject: "ìˆ˜í•™I(ìˆ˜ì—´)", q: "ì²«ì§¸í•­ì´ 1ì´ê³  ê³µë¹„ê°€ 2ì¸ ë“±ë¹„ìˆ˜ì—´ì˜ ì œ10í•­ì€?", options: ["256", "512", "1024", "2048"], a: 1 },

            // English
            { subject: "ì˜ì–´(ë…í•´)", q: "ë¬¸ì¥ì˜ ë…¼ë¦¬ì  ìˆœì„œ ë°°ì—´ ë¬¸ì œ: (A) James applied... (B) Committee was moved... (C) Daniel advocated... (D) Not long after...", options: ["A-C-D-B", "A-D-C-B", "A-B-C-D", "A-C-B-D"], a: 1 },
            { subject: "ì˜ì–´(ì–´íœ˜)", q: "'Advocated for his brother'ì—ì„œ advocatedì˜ ë¬¸ë§¥ì  ì˜ë¯¸ëŠ”?", options: ["ë¹„íŒí•˜ë‹¤", "ì§€ì§€í•˜ë‹¤", "ë¬´ì‹œí•˜ë‹¤", "ëŒ€ì‹ í•˜ë‹¤"], a: 1 },
            { subject: "ì˜ì–´(ë¹ˆì¹¸)", q: "Scientific knowledge is ______; it is constantly revised based on new evidence.", options: ["absolute", "tentative", "subjective", "dogmatic"], a: 1 },
            { subject: "ì˜ì–´(ë¬¸ë²•)", q: "ë°‘ì¤„ ì¹œ ë¶€ë¶„ ì¤‘ ì–´ë²•ìƒ í‹€ë¦° ê²ƒì€? 'She was looking forward to *go* to the party.'", options: ["was", "looking", "forward", "go"], a: 3 },
            { subject: "ì˜ì–´(í•¨ì¶•)", q: "'Read between the lines'ì˜ ì˜ë¯¸ëŠ”?", options: ["í° ì†Œë¦¬ë¡œ ì½ë‹¤", "ìˆ¨ê²¨ì§„ ì˜ë¯¸ íŒŒì•…í•˜ë‹¤", "ì¤„ì„ ì„œì„œ ê¸°ë‹¤ë¦¬ë‹¤", "ì±…ì„ ë§ì´ ì½ë‹¤"], a: 1 },

            // Science 
            { subject: "í†µí•©ê³¼í•™", q: "ì—˜ë‹ˆë‡¨ ì‹œê¸° ë™íƒœí‰ì–‘ ì ë„ ë¶€ê·¼ í•´ì—­ì—ì„œ ë‚˜íƒ€ë‚˜ëŠ” íŠ¹ì§•ì€?", options: ["ìš©ìŠ¹ ê°•í™”", "í‘œì¸µ ìˆ˜ì˜¨ í•˜ê°•", "ê°•ìˆ˜ëŸ‰ ì¦ê°€", "ë¬´ì—­í’ ê°•í™”"], a: 2 },
            { subject: "í™”í•™I", q: "ì¤‘í™” ë°˜ì‘ì—ì„œ HClê³¼ NaOHê°€ ì™„ì „íˆ ë°˜ì‘í–ˆì„ ë•Œ ìƒì„±ë˜ëŠ” ë¬¼ì§ˆì€?", options: ["ë¬¼ê³¼ ì—¼", "ì‚°ì†Œì™€ ìˆ˜ì†Œ", "ì•™ê¸ˆê³¼ ê¸°ì²´", "ì´ì˜¨ ê²°í•© í™”í•©ë¬¼ë§Œ"], a: 0 },
            { subject: "ë¬¼ë¦¬í•™I", q: "ë“±ê°€ì†ë„ ì§ì„  ìš´ë™ì„ í•˜ëŠ” ë¬¼ì²´ì˜ ì†ë„-ì‹œê°„ ê·¸ë˜í”„ì—ì„œ ê¸°ìš¸ê¸°ê°€ ì˜ë¯¸í•˜ëŠ” ê²ƒì€?", options: ["ë³€ìœ„", "ì´ë™ ê±°ë¦¬", "ê°€ì†ë„", "í‰ê·  ì†ë„"], a: 2 },
            { subject: "ìƒëª…ê³¼í•™I", q: "ì‚¬ëŒì˜ ì²´ì„¸í¬ ë¶„ì—´ ì¤‘ê¸°ì—ì„œ ê´€ì°°í•  ìˆ˜ ìˆëŠ” ê²ƒì€?", options: ["ìƒë™ ì—¼ìƒ‰ì²´ ì ‘í•©", "2ê°€ ì—¼ìƒ‰ì²´", "ì—¼ìƒ‰ ë¶„ì²´ ë¶„ë¦¬", "ì ë„íŒì— ë°°ì—´ëœ ì—¼ìƒ‰ì²´"], a: 3 },
            { subject: "ì§€êµ¬ê³¼í•™I", q: "íƒœí’ì˜ ëˆˆì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?", options: ["ìƒìŠ¹ ê¸°ë¥˜ê°€ ê°•í•˜ë‹¤.", "ê¸°ì••ì´ ê°€ì¥ ë†’ë‹¤.", "ì•½í•œ í•˜ê°• ê¸°ë¥˜ê°€ ë‚˜íƒ€ë‚œë‹¤.", "í’ì†ì´ ê°€ì¥ ê°•í•˜ë‹¤."], a: 2 },
            { subject: "í™”í•™II(í‚¬ëŸ¬)", q: "ì´ìƒ ê¸°ì²´ ìƒíƒœ ë°©ì •ì‹ PV=nRTì—ì„œ Rì€ ë¬´ì—‡ì¸ê°€?", options: ["ë³´ì¼ ìƒìˆ˜", "ê¸°ì²´ ìƒìˆ˜", "ì•„ë³´ê°€ë“œë¡œ ìˆ˜", "í”Œë‘í¬ ìƒìˆ˜"], a: 1 },

            // Social Studies
            { subject: "í†µí•©ì‚¬íšŒ", q: "ë¹„êµ ìš°ìœ„ë¡ ì— ë”°ë¼ ê°êµ­ì´ ë¬´ì—­ì„ í•  ë•Œ ì–»ëŠ” ì´ìµì˜ ê·¼ê±°ëŠ”?", options: ["ê¸°íšŒë¹„ìš©ì˜ ì°¨ì´", "ì ˆëŒ€ ìƒì‚°ë¹„ì˜ ìš°ìœ„", "ë…¸ë™ ì¸êµ¬ìˆ˜", "ì²œì—° ìì›ëŸ‰"], a: 0 },
            { subject: "ìƒí™œê³¼ìœ¤ë¦¬", q: "ë¡¤ìŠ¤ì˜ ì •ì˜ë¡ ì—ì„œ 'ë¬´ì§€ì˜ ë² ì¼'ì„ ì“´ ë‹¹ì‚¬ìë“¤ì´ í•©ì˜í•  ë¶„ë°° ì›ì¹™ì€?", options: ["ê³µë¦¬ì£¼ì˜ ì›ì¹™", "ìµœì†Œ ìˆ˜í˜œì ìµœëŒ€ ì´ìµ", "ëŠ¥ë ¥ì— ë”°ë¥¸ ë¶„ë°°", "ì ˆëŒ€ì  í‰ë“±"], a: 1 },
            { subject: "ì‚¬íšŒë¬¸í™”", q: "ì‚¬íšŒ ë¬¸ì œë¥¼ ì‚¬íšŒ êµ¬ì¡°ì  ëª¨ìˆœì—ì„œ ì°¾ëŠ” ê´€ì ì€?", options: ["ê¸°ëŠ¥ë¡ ", "ê°ˆë“±ë¡ ", "ìƒì§•ì  ìƒí˜¸ì‘ìš©ë¡ ", "êµí™˜ ì´ë¡ "], a: 1 },
            { subject: "í•œêµ­ì§€ë¦¬", q: "ìš°ë¦¬ë‚˜ë¼ì˜ ì˜í•´ ì„¤ì • ê¸°ì¤€ì„  ì¤‘ ë™í•´ì•ˆì—ì„œ ì£¼ë¡œ ì ìš©ë˜ëŠ” ê²ƒì€?", options: ["í†µìƒ ê¸°ì„ ", "ì§ì„  ê¸°ì„ ", "ì¤‘ê°„ì„ ", "ì ‘ì† ìˆ˜ì—­"], a: 0 },
            { subject: "ìœ¤ë¦¬ì™€ì‚¬ìƒ", q: "ë§¹ìê°€ ì£¼ì¥í•œ ì¸ê°„ì˜ ë³¸ì„±ì€?", options: ["ì„±ì„ ì„¤", "ì„±ì•…ì„¤", "ì„±ë¬´ì„ ì•…ì„¤", "ì„±ê¸°í˜¸ì„¤"], a: 0 },
            { subject: "ê²½ì œ(í‚¬ëŸ¬)", q: "ìˆ˜ìš”ì˜ ê°€ê²© íƒ„ë ¥ì„±ì´ 1ë³´ë‹¤ í´ ë•Œ, ê°€ê²©ì„ ì¸ìƒí•˜ë©´ ê¸°ì—…ì˜ ì´ìˆ˜ì…ì€?", options: ["ì¦ê°€í•œë‹¤", "ê°ì†Œí•œë‹¤", "ë¶ˆë³€ì´ë‹¤", "ì•Œ ìˆ˜ ì—†ë‹¤"], a: 1 }
        ];

        // --- Question Pools for Interview ---
        const commonQuestions = {
            'motivation': [
                { q: "ìš°ë¦¬ ëŒ€í•™(í•™ê³¼)ì— ì§€ì›í•˜ê²Œ ëœ ê°€ì¥ ì†”ì§í•œ ê³„ê¸°ëŠ”?", options: ["ì„±ì ì— ë§ì¶°ì„œ", "ë¶€ëª¨ë‹˜ì˜ ê¶Œìœ ", "í•´ë‹¹ ë¶„ì•¼ì— ëŒ€í•œ í•™ë¬¸ì  í˜¸ê¸°ì‹¬ê³¼ ë¹„ì „", "ì·¨ì—…ì´ ì˜ ë  ê²ƒ ê°™ì•„ì„œ"], a: 2 },
                { q: "ìì‹ ì„ í•œ ë‹¨ì–´ë¡œ í‘œí˜„í•œë‹¤ë©´ ë¬´ì—‡ì´ê³ , ê·¸ ì´ìœ ëŠ”?", options: ["ìŠ¤í€ì§€(í¡ìˆ˜ë ¥)", "ë‚˜ë¬´ëŠ˜ë³´(ê²Œìœ¼ë¦„)", "ë…ë¶ˆì¥êµ°(ê³ ì§‘)", "ë°”ëŒ(ììœ ë¡œì›€)"], a: 0 },
                { q: "ê³ êµ 3ë…„ ë™ì•ˆ ê°€ì¥ í›„íšŒë˜ëŠ” ìˆœê°„ì´ ìˆë‹¤ë©´?", options: ["ê³µë¶€ë¥¼ ë” ì—´ì‹¬íˆ í•˜ì§€ ì•Šì€ ê²ƒ", "ì¹œêµ¬ë“¤ê³¼ ë” ë†€ì§€ ëª»í•œ ê²ƒ", "ì§„ë¡œì— ëŒ€í•´ ê¹Šì´ ê³ ë¯¼í•˜ì§€ ì•Šì€ ê²ƒ", "ê¸‰ì‹ì„ ë‚¨ê¸´ ê²ƒ"], a: 2 },
                { q: "ëŒ€í•™ ì…í•™ í›„ ê°€ì¥ í•˜ê³  ì‹¶ì€ ê³µë¶€ë‚˜ í™œë™ì€?", options: ["ë¯¸íŒ…ê³¼ ë™ì•„ë¦¬ í™œë™", "ì „ê³µ ì‹¬í™” ì—°êµ¬ ë° í”„ë¡œì íŠ¸", "ì•„ë¥´ë°”ì´íŠ¸", "ê²Œì„"], a: 1 }
            ],
            'school_life': [
                { q: "ìƒí™œê¸°ë¡ë¶€ì—ì„œ ê°€ì¥ ì˜ë¯¸ ìˆê²Œ ìƒê°í•˜ëŠ” í™œë™ì€?", options: ["êµê³¼ ìš°ìˆ˜ìƒ ìˆ˜ìƒ", "ë™ì•„ë¦¬ì—ì„œ ë¦¬ë”ì‹­ì„ ë°œíœ˜í•´ ê°ˆë“±ì„ í•´ê²°í•œ ê²½í—˜", "ì¹œêµ¬ë“¤ê³¼ ë§¤ì  ê°„ ê²½í—˜", "ì•¼ê°„ììœ¨í•™ìŠµ ë„ì£¼"], a: 1 },
                { q: "ë¦¬ë”ì‹­ì„ ë°œíœ˜í•´ ê³µë™ì²´ì˜ ë¬¸ì œë¥¼ í•´ê²°í•œ ê²½í—˜ì´ ìˆëŠ”ê°€?", options: ["ì—†ìŠµë‹ˆë‹¤. ì „ íŒ”ë¡œì›Œì…ë‹ˆë‹¤.", "ì¶•ì œ ì¤€ë¹„ ì¤‘ ì˜ê²¬ ì¶©ëŒì„ ì¡°ìœ¨í•˜ì—¬ ì„±ê³µì ìœ¼ë¡œ ë§ˆì¹œ ê²½í—˜", "ì¡°ì¥ì´ ë˜ì–´ ì¡°ì›ë“¤ì—ê²Œ ì¼ì„ ë‹¤ ì‹œí‚¨ ê²½í—˜", "ë‚˜ì„œê¸° ì‹«ì–´ì„œ ì¡°ìš©íˆ ìˆì—ˆìŠµë‹ˆë‹¤."], a: 1 },
                { q: "ë´‰ì‚¬í™œë™ ì‹œê°„ì´ ë§ì€ë°, ë¬´ì—‡ì„ ëŠê¼ˆëŠ”ê°€?", options: ["ì‹œê°„ ì±„ìš°ëŠë¼ í˜ë“¤ì—ˆìŠµë‹ˆë‹¤.", "íƒ€ì¸ì„ ë•ëŠ” ê¸°ì¨ê³¼ ê³µë™ì²´ ì˜ì‹", "ìŠ¤í™ ìŒ“ê¸° ìš©ì´ì—ˆìŠµë‹ˆë‹¤.", "ê¸°ì–µì´ ì•ˆ ë‚©ë‹ˆë‹¤."], a: 1 },
                { q: "ìì‹ ë§Œì˜ ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œë²•ì´ë‚˜ ë©˜íƒˆ ê´€ë¦¬ ë…¸í•˜ìš°ëŠ”?", options: ["ì ì„ ì¡ë‹ˆë‹¤.", "ì¹œêµ¬ë“¤ê³¼ ìˆ˜ë‹¤ë¥¼ ë–±ë‹ˆë‹¤.", "ê¸ì •ì ì¸ ë§ˆì¸ë“œì…‹ê³¼ ì·¨ë¯¸ ìƒí™œ", "í™”ëƒ…ë‹ˆë‹¤."], a: 2 },
                { q: "ì¡´ê²½í•˜ëŠ” ì¸ë¬¼ì´ë‚˜ ì‚¶ì˜ ë¡¤ëª¨ë¸ì´ ìˆëŠ”ê°€?", options: ["ìœ ëª… ì—°ì˜ˆì¸", "ë¶€ëª¨ë‹˜", "ìì‹ ì˜ ë¶„ì•¼ì—ì„œ í˜ì‹ ì„ ì´ë£¬ ì¸ë¬¼", "ëˆ ë§ì€ ê¸°ë¶€ì"], a: 2 }
            ]
        };

        const majorQuestions = {
            'ì˜í•™': [
                { q: "[ì˜ë£Œìœ¤ë¦¬] ì¹˜ë£Œ ê°€ëŠ¥ì„±ì´ í¬ë°•í•œ ë§ê¸° í™˜ìì˜ ì—°ëª… ì¹˜ë£Œ ì¤‘ë‹¨ì— ëŒ€í•œ ë³¸ì¸ì˜ ê²¬í•´ëŠ”?", options: ["ìƒëª…ì€ ì¡´ì—„í•˜ë¯€ë¡œ ëê¹Œì§€ ì¹˜ë£Œí•´ì•¼ í•œë‹¤.", "í™˜ìì˜ ê³ í†µê³¼ ì¡´ì—„ì‚¬ë¥¼ ê³ ë ¤í•´ ì¤‘ë‹¨í•  ìˆ˜ ìˆë‹¤.", "ê²½ì œì  ë¹„ìš©ì„ ìµœìš°ì„ ìœ¼ë¡œ ê³ ë ¤í•´ì•¼ í•œë‹¤.", "ê°€ì¡±ì˜ ê²°ì •ì— ë¬´ì¡°ê±´ ë”°ë¼ì•¼ í•œë‹¤."], a: 1 },
                { q: "[ì „ê³µì í•©] í•­ìƒì œ ë‚´ì„±ê· (ìŠˆí¼ë°•í…Œë¦¬ì•„)ì˜ ì¶œí˜„ ì›ì¸ê³¼ í•´ê²° ë°©ì•ˆì€?", options: ["ë°”ì´ëŸ¬ìŠ¤ ë³€ì´ / ë°±ì‹  ê°œë°œ", "ì˜¤ë‚¨ìš©ì— ì˜í•œ ìì—°ì„ íƒ / ì ì • íˆ¬ì—¬ ë° ì‹ ì•½ ê°œë°œ", "ë©´ì—­ë ¥ ì €í•˜ / ì˜ì–‘ ì„­ì·¨", "í™˜ê²½ ì˜¤ì—¼ / ì •í™”ì¡° ì„¤ì¹˜"], a: 1 },
                { q: "[ì‹œì‚¬] ì˜ëŒ€ ì¦ì› ì´ìŠˆì™€ ê´€ë ¨í•˜ì—¬, í•„ìˆ˜ì˜ë£Œ ì¸ë ¥ ë¶€ì¡±ì„ í•´ê²°í•˜ê¸° ìœ„í•œ ê·¼ë³¸ì ì¸ ëŒ€ì±…ì€?", options: ["ë‹¨ìˆœíˆ ì˜ì‚¬ ìˆ˜ë§Œ ëŠ˜ë¦¬ë©´ í•´ê²°ëœë‹¤.", "ìˆ˜ê°€ ì²´ê³„ ê°œì„  ë° ê¸°í”¼ê³¼ ì§€ì› ê°•í™”ê°€ ë³‘í–‰ë˜ì–´ì•¼ í•œë‹¤.", "ì˜ëŒ€ ì •ì›ì„ ì¤„ì—¬ì•¼ í•œë‹¤.", "ì™¸êµ­ ì˜ì‚¬ë¥¼ ìˆ˜ì…í•´ì•¼ í•œë‹¤."], a: 1 },
                { q: "[ìƒëª…ê³¼í•™] CRISPR ìœ ì „ì ê°€ìœ„ ê¸°ìˆ ì˜ ìœ¤ë¦¬ì  ìŸì ì€?", options: ["ë§ì¶¤í˜• ì•„ê¸° íƒ„ìƒ ìš°ë ¤ ë° ìœ ì „ì í’€ ë‹¤ì–‘ì„± ê°ì†Œ", "ì‹ëŸ‰ ìƒì‚° ì¦ëŒ€", "ì•” ì¹˜ë£Œ ë¹„ìš© ê°ì†Œ", "ì‹¤í—˜ì‹¤ ì˜¤ì—¼"], a: 0 }
            ],
            'ìì—°': [
                { q: "[ê³¼í•™íƒêµ¬] ê¸°í›„ ìœ„ê¸°ì˜ ì£¼ì›ì¸ì¸ ì˜¨ì‹¤íš¨ê³¼ë¥¼ ì¼ìœ¼í‚¤ëŠ” ì£¼ëœ ê¸°ì²´ëŠ”?", options: ["ì§ˆì†Œ(N2)", "ì‚°ì†Œ(O2)", "ì´ì‚°í™”íƒ„ì†Œ(CO2)", "ìˆ˜ì†Œ(H2)"], a: 2 },
                { q: "[ê³µí•™ìœ¤ë¦¬] ììœ¨ì£¼í–‰ì°¨ ì‚¬ê³  ì‹œ ì±…ì„ ì†Œì¬(íŠ¸ë¡œì´ ë”œë ˆë§ˆ)ëŠ” ëˆ„êµ¬ì—ê²Œ ìˆëŠ”ê°€?", options: ["ì œì¡°ì‚¬(ì•Œê³ ë¦¬ì¦˜ ì„¤ê³„ì)", "íƒ‘ìŠ¹ì", "ë³´í–‰ì", "ë²•ì  í•©ì˜ê°€ í•„ìš”í•œ ë³µí•©ì  ë¬¸ì œ"], a: 3 },
                { q: "[ë¬¼ë¦¬] ë°˜ë„ì²´ì˜ ì›ë¦¬ì¸ 'ì—ë„ˆì§€ ë  ì´ë¡ 'ì—ì„œ ë„ì²´ì™€ ë¶€ë„ì²´ì˜ ì°¨ì´ëŠ”?", options: ["ë í‹ˆ(Band Gap)ì˜ ìœ ë¬´ì™€ í¬ê¸°", "ì „ìì˜ ì§ˆëŸ‰ ì°¨ì´", "ì›ìí•µì˜ í¬ê¸°", "ì¤‘ë ¥ì˜ ì˜í–¥"], a: 0 },
                { q: "[í™”í•™] 2ì°¨ ì „ì§€ì˜ í•µì‹¬ ì†Œì¬ì¸ ë¦¬íŠ¬ì´ì˜¨ ë°°í„°ë¦¬ì˜ ì›ë¦¬ëŠ”?", options: ["ë¦¬íŠ¬ ì´ì˜¨ì´ ì–‘ê·¹ê³¼ ìŒê·¹ ì‚¬ì´ë¥¼ ì´ë™í•˜ë©° ì¶©ë°©ì „", "ë¦¬íŠ¬ì´ í•µë¶„ì—´ì„ ì¼ìœ¼í‚´", "ìˆ˜ì†Œì™€ ì‚°ì†Œì˜ ê²°í•©", "íƒœì–‘ê´‘ì„ ì „ê¸°ë¡œ ë³€í™˜"], a: 0 }
            ],
            'ì¸ë¬¸': [
                { q: "[ì‚¬íšŒì´ìŠˆ] ì €ì¶œì‚° ê³ ë ¹í™” ì‚¬íšŒì—ì„œ ê°€ì¥ ì‹œê¸‰í•œ ì •ì±…ì  ëŒ€ì‘ì€?", options: ["ì´ë¯¼ ì •ì±… í™•ëŒ€", "ë…¸ì¸ ë³µì§€ ì¶•ì†Œ", "ì²­ë…„ ì„¸ëŒ€ ì§€ì› ë° ì‚¬íšŒ êµ¬ì¡° ê°œí˜", "ì¶œì‚° ê°•ì œ"], a: 2 },
                { q: "[ê²½ì œ] ì¸í”Œë ˆì´ì…˜ì„ ì¡ê¸° ìœ„í•œ ì¤‘ì•™ì€í–‰ì˜ í†µí™” ì •ì±…ì€?", options: ["ê¸ˆë¦¬ ì¸í•˜", "ê¸ˆë¦¬ ì¸ìƒ", "í™”í ë°œí–‰ í™•ëŒ€", "ì„¸ê¸ˆ ê°ë©´"], a: 1 },
                { q: "[ì² í•™] ê³µë¦¬ì£¼ì˜ì  ê´€ì ì—ì„œ 'íŠ¸ë¡¤ë¦¬ ë”œë ˆë§ˆ'ì˜ ì˜¬ë°”ë¥¸ ì„ íƒì€?", options: ["ë‹¤ìˆ˜ë¥¼ ì‚´ë¦¬ê¸° ìœ„í•´ ì†Œìˆ˜ë¥¼ í¬ìƒí•œë‹¤.", "ì–´ë–¤ ê²½ìš°ì—ë„ ìƒëª…ì„ í¬ìƒì‹œí‚¬ ìˆ˜ ì—†ë‹¤.", "ìš´ëª…ì— ë§¡ê¸´ë‹¤.", "ë™ì „ì„ ë˜ì ¸ ê²°ì •í•œë‹¤."], a: 0 },
                { q: "[ì •ì¹˜] ë¯¼ì£¼ì£¼ì˜ì˜ ìœ„ê¸°ë¡œ ì§€ì ë˜ëŠ” 'í¬í“°ë¦¬ì¦˜'ì˜ íí•´ëŠ”?", options: ["ì—˜ë¦¬íŠ¸ì£¼ì˜ íƒ€íŒŒ", "ëŒ€ì¤‘ì˜ ì¸ê¸°ì— ì˜í•©í•˜ì—¬ ì¥ê¸°ì  êµ­ìµ í›¼ì†", "ì‹œë¯¼ ì°¸ì—¬ í™•ëŒ€", "ë³µì§€ ì¶•ì†Œ"], a: 1 }
            ],
            'ì˜ˆì²´ëŠ¥': [
                { q: "[ì˜ˆìˆ ê´€] í˜„ëŒ€ ë¯¸ìˆ ì—ì„œ 'ë‚œí•´í•¨'ì´ ê°–ëŠ” ê°€ì¹˜ëŠ”?", options: ["ê°€ì¹˜ ì—†ë‹¤", "ê´€ê°ì—ê²Œ ìƒˆë¡œìš´ ì‚¬ìœ ì™€ ì§ˆë¬¸ì„ ë˜ì§€ëŠ” ê²ƒ", "ê·¸ë¦¼ ì‹¤ë ¥ì„ ìˆ¨ê¸°ê¸° ìœ„í•¨", "ë¹„ì‹¸ê²Œ íŒ”ê¸° ìœ„í•¨"], a: 1 },
                { q: "[ì²´ìœ¡] ìŠ¤í¬ì¸ ë§¨ì‹­ì˜ í•µì‹¬ ê°€ì¹˜ëŠ”?", options: ["ìŠ¹ë¦¬ ì§€ìƒì£¼ì˜", "ê³µì •í•œ ê²½ìŸê³¼ ìƒëŒ€ ì¡´ì¤‘", "ì‹¬íŒì— ëŒ€í•œ í•­ì˜", "í™”ë ¤í•œ ì„¸ëŸ¬ë¨¸ë‹ˆ"], a: 1 },
                { q: "[ìŒì•…] í´ë˜ì‹ ìŒì•…ì´ í˜„ëŒ€ ì‚¬íšŒì—ì„œ ê°–ëŠ” ì˜ì˜ëŠ”?", options: ["ê³¼ê±°ì˜ ìœ ë¬¼ì¼ ë¿ì´ë‹¤.", "ì¸ê°„ ê°ì •ì˜ ê¹Šì´ë¥¼ íƒêµ¬í•˜ê³  ì •ì„œì  ì•ˆì •ì„ ì¤€ë‹¤.", "ë¶€ìœ ì¸µì˜ ì „ìœ ë¬¼ì´ë‹¤.", "ìˆ˜ë©´ ìœ ë„ìš©ì´ë‹¤."], a: 1 },
                { q: "[ë””ìì¸] 'í˜•íƒœëŠ” ê¸°ëŠ¥ì„ ë”°ë¥¸ë‹¤'ëŠ” ëª…ì œì˜ ì˜ë¯¸ëŠ”?", options: ["ë””ìì¸ì—ì„œ ê¸°ëŠ¥ì„±ì´ ì‹¬ë¯¸ì„±ë³´ë‹¤ ìš°ì„ ë˜ì–´ì•¼ í•œë‹¤.", "í™”ë ¤í•œ ì¥ì‹ì´ ìµœê³ ë‹¤.", "ê¸°ëŠ¥ì€ ì¤‘ìš”í•˜ì§€ ì•Šë‹¤.", "ê°€ê²©ì´ ë¹„ì‹¸ì•¼ í•œë‹¤."], a: 0 }
            ]
        };

        const essayTopics = {
            'ìì—°': [
                { title: "ë¬¸ì œ 1. ì—”íŠ¸ë¡œí”¼ì™€ ì—ë„ˆì§€", text: "ì—´ì—­í•™ ì œ2ë²•ì¹™ì— ë”°ë¥´ë©´ ê³ ë¦½ê³„ì˜ ì—”íŠ¸ë¡œí”¼ëŠ” í•­ìƒ ì¦ê°€í•œë‹¤. ì´ë¥¼ 'ì—ë„ˆì§€ì˜ ì§ˆ' ê´€ì ì—ì„œ ì„¤ëª…í•˜ê³ , ìš°ì£¼ì˜ ì—´ì  ì£½ìŒ(Heat Death)ì´ ì˜ë¯¸í•˜ëŠ” ë°”ë¥¼ ì„œìˆ í•˜ì‹œì˜¤.", options: ["ì—ë„ˆì§€ ì´ëŸ‰ ê°ì†Œ / ìš°ì£¼ ìˆ˜ì¶•", "ì—ë„ˆì§€ ì§ˆ ì €í•˜ / í‰í˜• ìƒíƒœ ë„ë‹¬(ëª¨ë“  í™œë™ ì •ì§€)", "ì—ë„ˆì§€ ì§ˆ í–¥ìƒ / ìƒˆë¡œìš´ ë³„ íƒ„ìƒ", "ì—”íŠ¸ë¡œí”¼ ê°ì†Œ / ì§ˆì„œ íšŒë³µ"], a: 1 },
                { title: "ë¬¸ì œ 2. ë¶ˆí™•ì •ì„±ê³¼ ê²°ì •ë¡ ", text: "í•˜ì´ì  ë² ë¥´í¬ì˜ ë¶ˆí™•ì •ì„± ì›ë¦¬ëŠ” ë¯¸ì‹œ ì„¸ê³„ì—ì„œ ìœ„ì¹˜ì™€ ìš´ë™ëŸ‰ì„ ë™ì‹œì— ì •í™•íˆ ì¸¡ì •í•  ìˆ˜ ì—†ìŒì„ ì‹œì‚¬í•œë‹¤. ì´ê²ƒì´ ê³ ì „ ì—­í•™ì  ê²°ì •ë¡ ì— ë¯¸ì¹˜ëŠ” ì² í•™ì  í•¨ì˜ëŠ”?", options: ["ë¼í”Œë¼ìŠ¤ì˜ ì•…ë§ˆëŠ” ì¡´ì¬í•œë‹¤", "ëª¨ë“  ë¯¸ë˜ëŠ” ì˜ˆì¸¡ ê°€ëŠ¥í•˜ë‹¤", "ì¸ê³¼ìœ¨ì˜ ë¶•ê´´ ë° í™•ë¥ ì  ì„¸ê³„ê´€ ëŒ€ë‘", "ê´€ì¸¡ ì¥ë¹„ì˜ í•œê³„ì¼ ë¿ì´ë‹¤"], a: 2 }
            ],
            'ì¸ë¬¸': [
                { title: "ë¬¸ì œ 1. ì •ì˜ë€ ë¬´ì—‡ì¸ê°€", text: "ì¡´ ë¡¤ìŠ¤ì˜ 'ë¬´ì§€ì˜ ë² ì¼' ìƒíƒœì—ì„œ í•©ì˜ë  ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” 'ì°¨ë“±ì˜ ì›ì¹™'ì€ ë¬´ì—‡ì„ ì •ë‹¹í™”í•˜ëŠ”ê°€?", options: ["ëª¨ë“  ê²°ê³¼ì˜ ì ˆëŒ€ì  í‰ë“±", "ëŠ¥ë ¥ì— ë”°ë¥¸ ë¬´ì œí•œì  ë³´ìƒ", "ìµœì†Œ ìˆ˜í˜œìì—ê²Œ ìµœëŒ€ ì´ìµì´ ëŒì•„ê°€ëŠ” ë¶ˆí‰ë“±", "ììœ  ì‹œì¥ì˜ ì™„ì „í•œ ë°©ì„"], a: 2 },
                { title: "ë¬¸ì œ 2. ê°ì‹œì™€ ì²˜ë²Œ", text: "ë¯¸ì…¸ í‘¸ì½”ê°€ ì–¸ê¸‰í•œ 'íŒì˜µí‹°ì½˜'ì˜ ì›ë¦¬ê°€ í˜„ëŒ€ ì •ë³´ ì‚¬íšŒì—ì„œ 'ë””ì§€í„¸ íŒì˜µí‹°ì½˜'ìœ¼ë¡œ í™•ì¥ë  ë•Œ ë°œìƒí•˜ëŠ” ì£¼ëœ ë¬¸ì œëŠ”?", options: ["ë²”ì£„ìœ¨ ê°ì†Œ", "ì •ë³´ì˜ íš¨ìœ¨ì  ê´€ë¦¬", "ê·œìœ¨ ë‚´ë©´í™”ë¡œ ì¸í•œ ì£¼ì²´ì„± ìƒì‹¤ ë° ì‚¬ìƒí™œ ì¹¨í•´", "í†µì‹  ì†ë„ ì €í•˜"], a: 2 }
            ]
        };

        // Game State
        let player = { name: "", school: "", gender: "M", track: "ì¸ë¬¸", major: "", gpa: 0, sat: 0 };
        let currentQuizQueue = [];
        let currentRound = 0;
        let maxRounds = 5;
        let consecutiveCorrect = 0;
        let susiCart = [];
        let jeongsiCart = [];
        let finalResults = []; 
        let passedUniversities = []; 
        let selectedFinalUniversity = null; 
        let jonghapScore = 0;
        let nonsulScore = 0;
        let practicalScore = 0; 
        let reactionTimer, reactionStartTime, reactionState = 'waiting';
        let interviewStage = 0;
        let currentEssayQ = 0;
        let currentPenaltyMode = null;
        let usedQuestions = [];
        let criticalFailure = false; 
        let isRecordSaved = false;   

        // --- Core Functions ---
        window.toggleMajorInput = function() {
            const track = document.getElementById('input-track').value;
            const majorInput = document.getElementById('input-major');
            const body = document.getElementById('main-body');
            const title = document.getElementById('game-title');

            if (track === 'ì˜í•™') {
                majorInput.value = "ì˜ì˜ˆê³¼";
                body.classList.remove('bg-cute-pattern');
                body.classList.add('bg-medical');
                title.classList.add('text-cyan-600');
            } else {
                majorInput.value = "";
                body.classList.remove('bg-medical');
                body.classList.add('bg-cute-pattern');
                title.classList.remove('text-cyan-600');
            }
        }

        window.updateStatus = function() {
            const els = {
                name: document.getElementById('display-name'),
                major: document.getElementById('display-major'),
                gpa: document.getElementById('display-gpa'),
                sat: document.getElementById('display-sat'),
                combo: document.getElementById('combo-badge'),
                susi: document.getElementById('susi-badge'),
                jeongsi: document.getElementById('jeongsi-badge')
            };
            if(els.name) els.name.innerText = player.name;
            if(els.major) els.major.innerText = player.major || "ë¯¸ì •";
            if(els.gpa) els.gpa.innerText = player.gpa.toFixed(2);
            if(els.sat) els.sat.innerText = player.sat;
            if(els.susi) els.susi.innerText = susiCart.length;
            if(els.jeongsi) els.jeongsi.innerText = jeongsiCart.length;
            if(els.combo) {
                 if(consecutiveCorrect > 1) {
                    els.combo.classList.remove('hidden');
                    els.combo.innerText = `ğŸ”¥ ${consecutiveCorrect} COMBO!`;
                } else {
                    els.combo.classList.add('hidden');
                }
            }
        }

        window.switchScene = function(id) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden-section'));
            const target = document.getElementById(id);
            if(target) {
                target.classList.remove('hidden-section');
                target.classList.add('slide-in');
                window.scrollTo(0,0);
            }
        }

        window.resetGame = function(mode) {
            player = { name: "", school: "", gender: "M", track: "ì¸ë¬¸", major: "", gpa: 0, sat: 0 };
            currentQuizQueue = [];
            currentRound = 0;
            consecutiveCorrect = 0;
            susiCart = [];
            jeongsiCart = [];
            finalResults = []; 
            passedUniversities = [];
            selectedFinalUniversity = null;
            jonghapScore = 0; nonsulScore = 0; practicalScore = 0;
            usedQuestions = [];
            criticalFailure = false;
            isRecordSaved = false;
            
            currentPenaltyMode = mode;
            maxRounds = (mode === 'gunsu') ? 10 : 5;

            const alertBox = document.getElementById('penalty-alert');
            const body = document.getElementById('main-body');
            
            if(mode === 'jaesu') {
                if(alertBox) {
                    alertBox.classList.remove('hidden');
                    alertBox.innerHTML = 'âš ï¸ <b>ì¬ìˆ˜ìƒ ëª¨ë“œ ON:</b> ë‚´ì‹  0.5ë“±ê¸‰ ê°ì  / ìˆ˜ëŠ¥ +5ì  ë³´ë„ˆìŠ¤';
                    alertBox.className = "mb-6 p-4 rounded-2xl text-sm font-bold border-2 animate-pulse text-left font-game shadow-md bg-red-50 text-red-600 border-red-200";
                }
            } else if(mode === 'gunsu') {
                if(alertBox) {
                    alertBox.classList.remove('hidden');
                    alertBox.innerHTML = 'ğŸª– <b>êµ°ëŒ€ìŠ¤ë¦¬ê°€ ëª¨ë“œ ON:</b> ë‚´ì‹  0.7ë“±ê¸‰ ê°ì  / í€´ì¦ˆ ê¸°íšŒ 10íšŒ (ì—­ì „ ì°¬ìŠ¤!)';
                    alertBox.className = "mb-6 p-4 rounded-2xl text-sm font-bold border-2 animate-pulse text-left font-game shadow-md bg-green-800 text-white border-green-900";
                }
                if(body) { body.classList.remove('bg-cute-pattern', 'bg-medical'); body.classList.add('bg-army'); }
            } else {
                 if(alertBox) alertBox.classList.add('hidden');
                 if(body) { body.classList.remove('bg-army', 'bg-medical'); body.classList.add('bg-cute-pattern'); }
                 currentPenaltyMode = null;
                 maxRounds = 5;
            }

            window.switchScene('scene-intro');
            document.querySelectorAll('#profile-form input').forEach(i => i.value = '');
        }

        // Form Submit
        const profileForm = document.getElementById('profile-form');
        if(profileForm) {
            profileForm.addEventListener('submit', (e) => {
                e.preventDefault();
                player.name = document.getElementById('input-name').value;
                player.school = document.getElementById('input-school').value;
                player.major = document.getElementById('input-major').value;
                player.gender = document.getElementById('input-gender').value;
                player.track = document.getElementById('input-track').value;
                
                let rawGpa = parseFloat(document.getElementById('input-gpa').value);
                let rawSat = parseInt(document.getElementById('input-sat').value);

                if(currentPenaltyMode === 'jaesu') { rawGpa = Math.min(9.0, rawGpa + 0.5); rawSat = Math.min(100, rawSat + 5); }
                if(currentPenaltyMode === 'gunsu') { rawGpa = Math.min(9.0, rawGpa + 0.7); }

                player.gpa = rawGpa;
                player.sat = rawSat;

                document.getElementById('status-bar').classList.remove('hidden');
                document.getElementById('status-bar').classList.add('flex');
                window.updateStatus();
                
                // Shuffle Quiz
                let shuffledPool = [...quizPool];
                for (let i = shuffledPool.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffledPool[i], shuffledPool[j]] = [shuffledPool[j], shuffledPool[i]];
                }
                currentQuizQueue = shuffledPool.slice(0, maxRounds);
                
                const tr = document.getElementById('total-rounds');
                if(tr) tr.innerText = maxRounds;

                window.switchScene('scene-quiz');
                window.loadQuiz();
            });
        }

        // Quiz Logic
        window.loadQuiz = function() {
            if(currentRound >= maxRounds) { setTimeout(window.startSusi, 500); return; }
            
            const crEl = document.getElementById('current-round');
            if(crEl) crEl.innerText = currentRound+1;
            
            const fb = document.getElementById('quiz-feedback');
            if(fb) fb.classList.add('hidden');
            
            const container = document.getElementById('quiz-container');
            const title = document.getElementById('quiz-title');
            
            const q = currentQuizQueue[currentRound];
            
            // Visual feedback for killer questions
            if (q.subject.includes("í‚¬ëŸ¬") || q.subject.includes("ìˆ˜í•™")) {
                 if(container) container.classList.add('killer-mode');
                 if(title) { title.innerHTML = "ğŸ”¥ í‚¬ëŸ¬ ë¬¸í•­ (ìŠ¹ê¸‰ ì‹¬ì‚¬)!"; title.classList.add('text-red-500'); }
            } else {
                 if(container) container.classList.remove('killer-mode');
                 if(title) { title.innerHTML = "ìˆ˜ëŠ¥ ì‹¤ì „ ëª¨ì˜ê³ ì‚¬"; title.classList.remove('text-red-500'); }
            }

            const subEl = document.getElementById('quiz-subject');
            if(subEl) subEl.innerText = q.subject;
            const qEl = document.getElementById('quiz-question');
            if(qEl) qEl.innerText = q.q;
            
            const opts = document.getElementById('quiz-options');
            if(opts) {
                opts.innerHTML = '';
                q.options.forEach((o, i) => {
                    const btn = document.createElement('button');
                    btn.className = "w-full text-left p-4 rounded-xl border-2 border-slate-100 hover:border-indigo-500 hover:bg-indigo-50 font-bold text-slate-600 transition active:scale-95";
                    btn.innerHTML = `<span class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded mr-2 text-xs">${i+1}</span> ${o}`;
                    btn.onclick = () => window.checkAnswer(i, q.a);
                    opts.appendChild(btn);
                });
            }
        }
        
        window.checkAnswer = function(sel, ans) {
            const fb = document.getElementById('quiz-feedback');
            const icon = document.getElementById('feedback-icon');
            const text = document.getElementById('feedback-text');
            const detail = document.getElementById('feedback-detail');
            
            if(fb) fb.classList.remove('hidden');
            const opts = document.getElementById('quiz-options');
            if(opts) opts.querySelectorAll('button').forEach(b=>b.disabled=true);
            
            if(sel===ans) {
                consecutiveCorrect++;
                const gpaBonus = 0.1 + (consecutiveCorrect-1)*0.05;
                const satBonus = 2;
                player.gpa = Math.max(1.0, player.gpa - gpaBonus);
                player.sat = Math.min(100, player.sat + satBonus);
                
                if(icon) icon.innerHTML = "â­•";
                if(text) text.innerHTML = "ì •ë‹µì…ë‹ˆë‹¤!";
                if(detail) detail.innerHTML = `<span class="score-change score-up">ë‚´ì‹  -${gpaBonus.toFixed(2)} â–¼</span> <span class="score-change score-up">ìˆ˜ëŠ¥ +${satBonus} â–²</span>`;
                playSuccessSound();
            } else {
                consecutiveCorrect = 0;
                player.gpa = Math.min(9.0, player.gpa + 0.1);
                player.sat = Math.max(0, player.sat - 3); // Penalty added
                
                if(icon) icon.innerHTML = "âŒ";
                if(text) text.innerHTML = "ì˜¤ë‹µì…ë‹ˆë‹¤...";
                if(detail) detail.innerHTML = `<span class="score-change score-down">ë‚´ì‹  +0.1 â–²</span> <span class="score-change score-down">ìˆ˜ëŠ¥ -3 â–¼</span>`;
                playFailSound();
            }
            window.updateStatus();
        }
        const nextQuiz = document.getElementById('next-quiz-btn');
        if(nextQuiz) nextQuiz.onclick = () => { currentRound++; window.loadQuiz(); };

        // Susi Logic
        window.startSusi = function() {
            window.switchScene('scene-susi');
            window.updateStatus(); 
            const defaultFilter = player.track === 'ì˜í•™' ? 'medical' : 'all';
            
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.classList.remove('active', 'bg-slate-800', 'text-white');
                if(b.dataset.filter === defaultFilter) b.classList.add('active', 'bg-slate-800', 'text-white');
            });
            window.renderSusiList(defaultFilter);
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.onclick = (e) => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active', 'bg-slate-800','text-white'));
                    e.target.classList.add('active', 'bg-slate-800','text-white');
                    window.renderSusiList(e.target.dataset.filter);
                };
            });
        }
        
        window.renderSusiList = function(filter) {
            const list = document.getElementById('susi-uni-list');
            if(!list) return;
            list.innerHTML = '';
            
            universities.forEach(u => {
                if(player.gender === 'M' && u.gender === 'F') return;
                
                if (filter === 'all') {
                     if (u.tier === 'medical' && player.track !== 'ì˜í•™') return;
                } else if (filter === 'medical') {
                     if (u.tier !== 'medical') return;
                } else {
                     if (u.tier !== filter) return;
                }

                let targetCut = u.cut_h; 
                if(player.track === 'ìì—°' || player.track === 'ì˜í•™') targetCut = u.cut_n;
                if(player.track === 'ì˜ˆì²´ëŠ¥') targetCut += 1.0;

                const diff = player.gpa - targetCut;
                let badge = diff <= -0.2 ? "ì•ˆì •" : (diff <= 0.1 ? "ì ì •" : "ìƒí–¥");
                let badgeColor = diff <= -0.2 ? "bg-green-100 text-green-700" : (diff <= 0.1 ? "bg-blue-100 text-blue-700" : "bg-red-100 text-red-700");

                let recommendTag = "";
                if(diff >= 0 && badge !== "ìƒí–¥") recommendTag = '<span class="ai-recommend ml-2">ğŸ‘ AIì¶”ì²œ</span>';

                const d = document.createElement('div');
                d.className = "university-card bg-white border border-slate-100 p-4 rounded-2xl flex justify-between items-center cursor-pointer transition-all";
                d.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-slate-50 rounded-full flex items-center justify-center text-xl ${u.color} shadow-sm border border-slate-100"><i class="${u.logo}"></i></div>
                        <div>
                            <div class="font-bold text-slate-800 font-game">${u.name} ${recommendTag}</div>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-[10px] ${badgeColor} px-2 py-0.5 rounded-full font-bold">${badge}</span>
                                <span class="text-xs text-slate-400">ì»· ${targetCut}</span>
                            </div>
                        </div>
                    </div>
                    <button class="add-btn w-9 h-9 rounded-full bg-indigo-50 text-indigo-600 hover:bg-indigo-600 hover:text-white flex items-center justify-center transition"><i class="fas fa-plus"></i></button>
                `;
                d.querySelector('.add-btn').onclick = () => window.openTypeModal(u);
                list.appendChild(d);
            });
        }

        window.openTypeModal = function(u) {
            if(susiCart.length >= 6) { alert("ìˆ˜ì‹œ ì›ì„œëŠ” ìµœëŒ€ 6ì¥ì…ë‹ˆë‹¤."); return; }
            selectedUniForModal = u;
            document.getElementById('modal-uni-name').innerText = u.name;
            const chojeoText = u.chojeo > 0 ? `ìˆ˜ëŠ¥ìµœì €: ìƒìœ„ ${100 - u.chojeo}% ì´ë‚´` : "ìˆ˜ëŠ¥ìµœì € ì—†ìŒ";
            document.getElementById('modal-uni-chojeo').innerText = chojeoText;
            document.getElementById('type-modal').classList.remove('hidden');
        }
        window.closeModal = function() { document.getElementById('type-modal').classList.add('hidden'); selectedUniForModal=null; }
        
        document.querySelectorAll('.type-select-btn').forEach(b => {
            b.onclick = () => { 
                if(selectedUniForModal) { 
                    const type = b.dataset.type;
                    if(susiCart.find(x => x.id === selectedUniForModal.id && x.type === type)) {
                        alert("ì´ë¯¸ í•´ë‹¹ ëŒ€í•™ì˜ ë™ì¼ ì „í˜•ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤."); return;
                    }
                    susiCart.push({...selectedUniForModal, type: type}); 
                    window.updateSusiCart(); 
                    window.closeModal(); 
                } 
            };
        });

        window.updateSusiCart = function() {
            const list = document.getElementById('susi-cart');
            const btn = document.getElementById('btn-susi-submit');
            
            if(list) {
                list.innerHTML = '';
                susiCart.forEach((u, i) => {
                    const li = document.createElement('li');
                    li.className = "flex justify-between items-center p-3 bg-white border border-slate-100 rounded-xl text-sm pop-in shadow-sm";
                    li.innerHTML = `<div><span class="font-bold text-xs bg-gray-100 px-1 rounded mr-1">${u.type}</span> ${u.name}</div><button onclick="window.removeSusiItem(${i})"><i class="fas fa-times text-red-300"></i></button>`;
                    list.appendChild(li);
                });
            }
            window.updateStatus();

            if(btn) {
                if(susiCart.length > 0) {
                    btn.disabled = false;
                    btn.className = "w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-2xl shadow-lg active:scale-95 transition-all font-game text-xl";
                    btn.innerText = `ìˆ˜ì‹œ ${susiCart.length}ì¥ ì ‘ìˆ˜í•˜ê¸°`;
                } else {
                    btn.disabled = true;
                    btn.className = "w-full bg-slate-200 text-slate-400 font-bold py-4 rounded-2xl transition-all cursor-not-allowed font-game text-xl";
                    btn.innerText = "ëŒ€í•™ì„ ì„ íƒí•˜ì„¸ìš”";
                }
            }
        }
        window.removeSusiItem = function(index) { susiCart.splice(index, 1); window.updateSusiCart(); }

        const susiSubmit = document.getElementById('btn-susi-submit');
        if(susiSubmit) {
            susiSubmit.onclick = () => {
                const needsExam = susiCart.some(u => u.type === 'ì¢…í•©' || u.type === 'ë…¼ìˆ ') || player.track === 'ì˜ˆì²´ëŠ¥';
                if(needsExam) window.switchScene('scene-exam-intro');
                else window.processSusiResults();
            };
        }

        window.startActualExams = function() {
            if(player.track === 'ì˜ˆì²´ëŠ¥') window.setupPractical(); 
            else if(susiCart.some(u=>u.type==='ì¢…í•©')) window.setupInterviewStage(0); 
            else if(susiCart.some(u=>u.type==='ë…¼ìˆ ')) window.setupEssay();
            else window.processSusiResults();
        }

        // --- UPGRADED Interview Logic (Random + 4 Stages) ---
        window.setupInterviewStage = function(stage) {
            interviewStage = stage;
            window.switchScene('scene-interview');
            const container = document.getElementById('interview-content');
            
            const steps = [0,1,2,3].map(n => `<div class="w-3 h-3 rounded-full ${n<=stage ? 'bg-green-500':'bg-slate-300'}"></div>`).join('');
            document.getElementById('interview-steps').innerHTML = steps;

            let q;
            let typeLabel = "";
            
            if(stage === 0) {
                typeLabel = "1. ê°€ì¹˜ê´€ ë° ìê¸°ì†Œê°œ";
                const pool = commonQuestions['motivation'];
                q = pool[Math.floor(Math.random() * pool.length)];
            } else if (stage === 1) { 
                typeLabel = "2. í•™êµ ìƒí™œ ë° ê¸°ë¡ë¶€";
                const pool = commonQuestions['school_life'];
                q = pool[Math.floor(Math.random() * pool.length)];
            } else {
                typeLabel = stage === 2 ? "3. ì „ê³µ ì í•©ì„±(ê¸°ì´ˆ)" : "4. ì „ê³µ ì í•©ì„±(ì‹¬í™”)";
                const trackKey = (player.track === 'ì˜í•™') ? 'ì˜í•™' : (player.track === 'ì˜ˆì²´ëŠ¥' ? 'ì˜ˆì²´ëŠ¥' : (player.track === 'ìì—°' ? 'ìì—°' : 'ì¸ë¬¸'));
                
                const pool = majorQuestions[trackKey];
                let availablePool = pool.filter(q => !usedQuestions.includes(q.q));
                if (availablePool.length === 0) availablePool = pool; 
                
                const randIndex = Math.floor(Math.random() * availablePool.length);
                q = availablePool[randIndex];
                usedQuestions.push(q.q);
            }

            if(container) {
                container.innerHTML = `
                    <div class="mb-6"><span class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-bold mb-2 inline-block">${typeLabel}</span><p class="font-bold text-xl text-slate-800 leading-relaxed">"${q.q}"</p></div>
                    <div class="grid gap-3">${q.options.map((o,i)=>`<button onclick="window.handleInterviewAnswer(${i}, ${q.a})" class="w-full text-left p-4 bg-white border-2 border-green-100 rounded-xl hover:bg-green-50 transition font-medium">${i+1}. ${o}</button>`).join('')}</div>
                `;
            }
        }

        window.handleInterviewAnswer = function(selected, answer) {
            if(selected === answer) {
                jonghapScore += 0.25; 
            } else {
                jonghapScore -= 0.5; 
                criticalFailure = true; 
            }

            if(interviewStage < 3) {
                window.setupInterviewStage(interviewStage + 1);
            } else {
                if(susiCart.some(u=>u.type==='ë…¼ìˆ ')) window.setupEssay();
                else window.processSusiResults();
            }
        }

        // --- UPGRADED Essay Logic (Multi-Question) ---
        window.setupEssay = function() {
            window.switchScene('scene-essay');
            currentEssayQ = 0;
            window.loadEssayQuestion();
        }

        window.loadEssayQuestion = function() {
            const container = document.getElementById('essay-content');
            const trackKey = (player.track === 'ì¸ë¬¸') ? 'ì¸ë¬¸' : 'ìì—°';
            const questions = essayTopics[trackKey];

            if (currentEssayQ >= questions.length) {
                window.processSusiResults();
                return;
            }

            const q = questions[currentEssayQ];
            const steps = questions.map((_, idx) => `<div class="w-3 h-3 rounded-full ${idx<=currentEssayQ ? 'bg-purple-500':'bg-slate-300'}"></div>`).join('');
            document.getElementById('essay-steps').innerHTML = steps;

            if(container) {
                container.innerHTML = `
                    <div class="mb-6">
                        <span class="bg-purple-100 text-purple-700 px-2 py-1 rounded text-xs font-bold mb-2 inline-block">${q.title}</span>
                        <p class="font-bold text-lg text-slate-800 leading-relaxed">${q.text}</p>
                    </div>
                    <div class="grid gap-3">
                        ${q.options.map((o,i)=>`<button onclick="window.handleEssayAnswer(${i}, ${q.a})" class="w-full text-left p-4 bg-white border-2 border-purple-100 rounded-xl hover:bg-purple-50 transition font-medium text-base">${i+1}. ${o}</button>`).join('')}
                    </div>
                `;
            }
        }

        window.handleEssayAnswer = function(sel, ans) {
            if(sel === ans) nonsulScore += 0.5; 
            else nonsulScore -= 0.2;
            
            currentEssayQ++;
            window.loadEssayQuestion();
        }

        // Practical (Reaction)
        window.setupPractical = function() {
            window.switchScene('scene-practical');
            window.startReactionTest();
        }
        window.startReactionTest = function() {
            const box = document.getElementById('reaction-area');
            const btn = document.getElementById('practical-next-btn');
            if(btn) btn.classList.add('hidden');

            if(box) {
                box.className = 'reaction-box reaction-waiting h-64 rounded-3xl flex items-center justify-center text-white text-3xl font-black font-game shadow-inner';
                box.innerText = "ë¹¨ê°„ìƒ‰ì¼ ë•Œ í´ë¦­í•˜ë©´ ì‹¤ê²©!";
                box.style.backgroundColor = "#ef4444"; 
            }
            reactionState = 'waiting';
            const delay = 2000 + Math.random() * 3000;
            reactionTimer = setTimeout(() => {
                reactionState = 'ready';
                if(box) {
                    box.className = 'reaction-box reaction-ready h-64 rounded-3xl flex items-center justify-center text-white text-3xl font-black font-game shadow-inner';
                    box.style.backgroundColor = "#22c55e"; 
                    box.innerText = "ì§€ê¸ˆ í´ë¦­í•˜ì„¸ìš”!!!";
                }
                reactionStartTime = Date.now();
            }, delay);
        }
        window.handleReactionClick = function() {
            if (reactionState === 'finished') return;

            const box = document.getElementById('reaction-area');
            if(reactionState === 'waiting') {
                clearTimeout(reactionTimer);
                if(box) { box.innerText = "ë„ˆë¬´ ë¹¨ëìŠµë‹ˆë‹¤! (ì‹¤ê²©)"; box.style.backgroundColor = "#94a3b8"; }
                practicalScore = -1.0;
                window.showPracticalNext();
            } else if (reactionState === 'ready') {
                const time = Date.now() - reactionStartTime;
                if(box) { 
                    box.style.backgroundColor = "#3b82f6";
                    if(time < 250) { box.innerText = `${time}ms Perfect!`; practicalScore = 1.0; }
                    else if(time < 400) { box.innerText = `${time}ms Good`; practicalScore = 0.5; }
                    else { box.innerText = `${time}ms Bad`; practicalScore = 0; }
                }
                window.showPracticalNext();
            }
            reactionState = 'finished';
        }
        window.showPracticalNext = function() {
            document.getElementById('practical-next-btn').classList.remove('hidden');
            document.getElementById('practical-next-btn').onclick = () => window.processSusiResults();
        }

        // Susi Processing
        window.processSusiResults = function() {
            window.switchScene('scene-susi-result');
            const list = document.getElementById('susi-result-list');
            if(list) list.innerHTML = '';
            passedUniversities = [];
            
            // Explicitly hide both outcome messages initially to prevent ghosting
            document.getElementById('susi-pass-msg').classList.add('hidden');
            document.getElementById('susi-fail-msg').classList.add('hidden');
            
            susiCart.forEach((u, i) => {
                setTimeout(() => {
                    let passed = false;
                    let baseCut = (player.track === 'ìì—°' || player.track === 'ì˜í•™') ? u.cut_n : u.cut_h;
                    if(player.track === 'ì˜ˆì²´ëŠ¥') baseCut += 1.0; 

                    if (u.type === 'êµê³¼') {
                        if (player.sat < u.chojeo) passed = false; 
                        else {
                            if (player.gpa <= baseCut + 0.05) passed = true; 
                            else passed = Math.random() < 0.1; 
                        }
                    } else {
                        let finalScore = baseCut;
                        
                        if (u.type === 'ì¢…í•©' && criticalFailure) {
                            finalScore -= 2.0; 
                        } else if(u.type==='ì¢…í•©') {
                            finalScore += (0.5 + jonghapScore); 
                        }
                        
                        if(u.type==='ë…¼ìˆ ') finalScore += (2.0 + nonsulScore); 
                        
                        const diff = finalScore - player.gpa;
                        let prob = (diff>0.5)?90:(diff>0)?60:(diff>-0.2)?20:1;
                        if(u.tier === 'medical') prob *= 0.8; 
                        
                        passed = Math.random()*100 < prob;
                    }

                    if(passed) {
                        passedUniversities.push({...u, method: 'ìˆ˜ì‹œ'});
                        playSuccessSound();
                    } else {
                        playFailSound();
                    }

                    const d = document.createElement('div');
                    d.className = "bg-white border rounded-2xl p-6 shadow-sm flex flex-col items-center justify-center pop-in";
                    d.innerHTML = `
                        <div class="text-xs text-slate-400 font-bold mb-1">${u.type}</div>
                        <div class="font-bold text-lg mb-2 font-game">${u.name}</div>
                        <div class="text-xl font-black ${passed?'text-green-600':'text-slate-300'} font-game">${passed?'í•©ê²©':'ë¶ˆí•©ê²©'}</div>
                        ${(u.type==='êµê³¼' && player.sat < u.chojeo) ? '<div class="text-xs text-red-400 mt-1 font-bold">ìµœì € ë¯¸ë‹¬</div>' : ''}
                        ${(u.type==='ì¢…í•©' && criticalFailure) ? '<div class="text-xs text-red-400 mt-1 font-bold">ë©´ì ‘ ê³¼ë½</div>' : ''}
                    `;
                    if(list) list.appendChild(d);

                    if(i === susiCart.length-1) {
                        document.getElementById('susi-outcome-controls').classList.remove('hidden');
                        if(passedUniversities.length > 0) {
                            document.getElementById('susi-pass-msg').classList.remove('hidden');
                            document.getElementById('susi-fail-msg').classList.add('hidden'); 
                        } else {
                            document.getElementById('susi-fail-msg').classList.remove('hidden');
                            document.getElementById('susi-pass-msg').classList.add('hidden'); 
                        }
                    }
                }, i*800);
            });
        }

        const susiFinalBtn = document.getElementById('go-to-final-choice-susi');
        if(susiFinalBtn) susiFinalBtn.onclick = () => window.showFinalSelection(passedUniversities);
        
        const jeongsiBtn = document.getElementById('go-to-jeongsi');
        if(jeongsiBtn) jeongsiBtn.onclick = window.startJeongsi;

        // Jeongsi Logic
        window.startJeongsi = function() {
            window.switchScene('scene-jeongsi');
            const defaultFilter = player.track === 'ì˜í•™' ? 'medical' : 'all';
             document.querySelectorAll('.j-filter-btn').forEach(b => {
                b.classList.remove('active', 'bg-slate-800', 'text-white');
                if(b.dataset.filter === defaultFilter) b.classList.add('active', 'bg-slate-800', 'text-white');
            });
            window.renderJeongsiList(defaultFilter);
            
            document.querySelectorAll('.j-filter-btn').forEach(btn => {
                btn.onclick = (e) => {
                    document.querySelectorAll('.j-filter-btn').forEach(b => b.classList.remove('active', 'bg-slate-800','text-white'));
                    e.target.classList.add('active', 'bg-slate-800','text-white');
                    window.renderJeongsiList(e.target.dataset.filter);
                };
            });
        }

        window.renderJeongsiList = function(filter) {
            const list = document.getElementById('jeongsi-uni-list');
            if(!list) return;
            list.innerHTML = '';
            
            universities.forEach(u => {
                if(player.gender === 'M' && u.gender === 'F') return;
                
                if (filter === 'all') {
                     if (u.tier === 'medical' && player.track !== 'ì˜í•™') return;
                } else if (filter === 'medical') {
                     if (u.tier !== 'medical') return;
                } else {
                     if (u.tier !== filter) return;
                }

                const diff = player.sat - u.jeongsi_cut;
                let badge = diff >= 3 ? "ì•ˆì •" : (diff >= 0 ? "ì ì •" : "ìƒí–¥");
                let badgeColor = diff >= 3 ? "bg-green-100 text-green-700" : (diff >= 0 ? "bg-blue-100 text-blue-700" : "bg-red-100 text-red-700");

                let recommendTag = "";
                if(diff >= 0) recommendTag = '<span class="ai-recommend ml-2">ğŸ‘ AIì¶”ì²œ</span>';

                const d = document.createElement('div');
                d.className = "university-card bg-white border border-slate-100 p-4 rounded-2xl flex justify-between items-center cursor-pointer transition-all";
                d.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-slate-50 rounded-full flex items-center justify-center text-xl ${u.color} shadow-sm border border-slate-100"><i class="${u.logo}"></i></div>
                        <div>
                            <div class="font-bold text-slate-800 font-game">${u.name} ${recommendTag}</div>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-[10px] ${badgeColor} px-2 py-0.5 rounded-full font-bold">${badge}</span>
                                <span class="text-xs text-slate-400">ì»· ${u.jeongsi_cut}%</span>
                            </div>
                        </div>
                    </div>
                    <button onclick="window.addToJeongsiCart(${u.id})" class="w-9 h-9 rounded-full bg-indigo-50 text-indigo-600 hover:bg-indigo-600 hover:text-white flex items-center justify-center transition"><i class="fas fa-plus"></i></button>
                `;
                list.appendChild(d);
            });
        }

        window.addToJeongsiCart = function(id) {
            if(jeongsiCart.length >= 3) { alert("ì •ì‹œëŠ” 3ì¥ì…ë‹ˆë‹¤."); return; }
            if(jeongsiCart.find(x=>x.id===id)) { alert("ì´ë¯¸ ì„ íƒí–ˆìŠµë‹ˆë‹¤."); return; }
            jeongsiCart.push(universities.find(u=>u.id===id));
            window.updateJeongsiCart();
        }

        window.updateJeongsiCart = function() {
            const list = document.getElementById('jeongsi-cart');
            const cnt = document.getElementById('jeongsi-count');
            const btn = document.getElementById('submit-jeongsi');
            
            if(cnt) cnt.innerText = jeongsiCart.length;
            if(list) {
                list.innerHTML = '';
                jeongsiCart.forEach((u, i) => {
                    const li = document.createElement('li');
                    li.className = "flex justify-between items-center p-3 bg-white border border-slate-100 rounded-xl text-sm pop-in shadow-sm";
                    li.innerHTML = `<span>${u.name}</span> <button onclick="window.removeJeongsiItem(${i})"><i class="fas fa-times text-red-300"></i></button>`;
                    list.appendChild(li);
                });
            }
            window.updateStatus();

            if(btn) {
                if(jeongsiCart.length > 0) {
                    btn.disabled = false;
                    btn.className = "w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-2xl shadow-lg active:scale-95 transition-all font-game text-xl";
                    btn.innerText = `ì •ì‹œ ${jeongsiCart.length}ì¥ ì ‘ìˆ˜í•˜ê¸°`;
                } else {
                    btn.disabled = true;
                    btn.className = "w-full bg-slate-200 text-slate-400 font-bold py-4 rounded-2xl cursor-not-allowed font-game text-xl";
                }
            }
        }
        
        window.removeJeongsiItem = function(index) {
            jeongsiCart.splice(index, 1);
            window.updateJeongsiCart();
        }

        const jeongsiSubmit = document.getElementById('submit-jeongsi');
        if(jeongsiSubmit) {
            jeongsiSubmit.onclick = () => {
                jeongsiCart.forEach(u => {
                    const diff = player.sat - u.jeongsi_cut;
                    let prob = 50 + diff*5; 
                    if(u.tier === 'medical') prob = 30 + diff*10; 
                    
                    if(prob>95) prob=95; if(prob<1) prob=1;
                    const passed = Math.random()*100 < prob;
                    if(passed) passedUniversities.push({...u, method: 'ì •ì‹œ'});
                    finalResults.push({name:u.name, status:passed?'í•©ê²©':'ë¶ˆí•©ê²©', type: 'ì •ì‹œ'});
                });

                window.switchScene('scene-jeongsi-announce');
                const container = document.getElementById('jeongsi-results-container');
                if(container) container.innerHTML = '';
                
                setTimeout(() => {
                    const loader = document.getElementById('jeongsi-loading');
                    if(loader) loader.classList.add('hidden');
                    if(container) container.classList.remove('opacity-0');
                    
                    finalResults.filter(r=>r.type === 'ì •ì‹œ').forEach((r, i) => { 
                        setTimeout(() => {
                            if(r.status==='í•©ê²©') playSuccessSound(); else playFailSound();
                            const d = document.createElement('div');
                            d.className = "bg-white border border-slate-100 p-5 rounded-2xl shadow-sm flex justify-between items-center pop-in";
                            d.innerHTML = `<span class="font-bold text-lg text-slate-800 font-game">${r.name}</span><span class="font-black text-xl ${r.status==='í•©ê²©'?'text-green-600':'text-slate-300'} font-game">${r.status}</span>`;
                            if(container) container.appendChild(d);
                        }, i * 800);
                    });

                    setTimeout(() => {
                        const nextControls = document.getElementById('jeongsi-next-controls');
                        if(nextControls) nextControls.classList.remove('hidden');
                        
                        if(passedUniversities.length > 0) {
                            const finalChoiceBtn = document.getElementById('go-to-final-choice-jeongsi');
                            if(finalChoiceBtn) finalChoiceBtn.classList.remove('hidden');
                        } else {
                            const failOptions = document.getElementById('jeongsi-fail-options');
                            if(failOptions) failOptions.classList.remove('hidden');
                        }
                    }, jeongsiCart.length * 800 + 500);
                }, 1500);
            };
        }

        const jeongsiFinalBtn = document.getElementById('go-to-final-choice-jeongsi');
        if(jeongsiFinalBtn) jeongsiFinalBtn.onclick = () => window.showFinalSelection(passedUniversities);

        window.showFinalSelection = function(passedList) {
            window.switchScene('scene-final-select');
            const container = document.getElementById('final-candidate-list');
            if(container) {
                container.innerHTML = '';
                passedList.forEach(u => {
                    const btn = document.createElement('button');
                    btn.className = "w-full bg-white border-2 border-blue-100 hover:border-blue-500 hover:bg-blue-50 p-6 rounded-2xl transition flex justify-between items-center group shadow-sm";
                    btn.innerHTML = `
                        <div class="flex items-center gap-4">
                            <i class="${u.logo} text-3xl ${u.color}"></i>
                            <div class="text-left">
                                <div class="font-bold text-xl text-slate-800 font-game">${u.name}</div>
                                <div class="text-sm text-slate-500 font-cute font-bold text-lg">${u.method} í•©ê²©</div>
                            </div>
                        </div>
                        <span class="text-blue-500 font-bold group-hover:underline font-game text-lg">ì„ íƒí•˜ê¸° âœ¨</span>
                    `;
                    btn.onclick = () => window.showFinalReport(u);
                    container.appendChild(btn);
                });
            }
        }

        window.showFinalReport = function(university) {
            selectedFinalUniversity = university;
            window.switchScene('scene-final');
            document.querySelector('.final-name').innerText = player.name;
            document.querySelector('.final-school-display').innerText = player.school;
            document.querySelectorAll('.final-gpa-display').forEach(e=>e.innerText=player.gpa.toFixed(2));
            document.querySelectorAll('.final-sat-display').forEach(e=>e.innerText=player.sat);
            
            const display = document.getElementById('final-university-display');
            if(display) {
                display.innerHTML = `
                    <div class="flex flex-col items-center">
                        <i class="${university.logo} text-8xl ${university.color} mb-6"></i>
                        <h3 class="text-4xl font-black text-slate-800 mb-2 font-game">${university.name}</h3>
                        <span class="bg-indigo-100 text-indigo-700 px-6 py-2 rounded-full font-bold font-game text-xl">${university.method} í•©ê²©</span>
                        <p class="mt-8 text-slate-500 text-center font-cute text-2xl font-bold leading-relaxed">
                            ìœ„ í•™ìƒì€ 2027í•™ë…„ë„ ëŒ€í•™ì…í•™ì „í˜•ì— ìµœì¢… í•©ê²©í•˜ì—¬<br>ë³¸êµì˜ ìë‘ìŠ¤ëŸ¬ìš´ ì‹ ì…ìƒì´ ë˜ì—ˆìŒì„ ì¦ëª…í•©ë‹ˆë‹¤.
                        </p>
                    </div>
                `;
            }
            
            // ì…ì‹œ ì „ëµ í‰ê°€ í•¨ìˆ˜ í˜¸ì¶œ
            window.evaluateAdmission(university);
            
            playSuccessSound();
        }
        
        window.evaluateAdmission = function(univ) {
            let score = 0;
            let grade = '';
            let comment = '';
            let diff = 0;

            if (univ.method === 'ìˆ˜ì‹œ') {
                let cut = (player.track === 'ìì—°' || player.track === 'ì˜í•™') ? univ.cut_n : univ.cut_h;
                if (player.track === 'ì˜ˆì²´ëŠ¥') cut += 1.0;
                // ë‚´ì‹ ì€ ë‚®ì„ìˆ˜ë¡(ìˆ«ìê°€ í´ìˆ˜ë¡) ì„±ì ì´ ë‚˜ìœ ê²ƒ.
                // diffê°€ ì–‘ìˆ˜ë©´ ë‚´ì‹ ì´ ì•ˆ ì¢‹ì€ë° í•©ê²©í•œ ê²ƒ -> ìš°ì£¼ ìƒí–¥
                diff = player.gpa - cut; 
                
                if (diff >= 0.4) { grade = 'S+'; score = 100; comment = "ê¸°ì ì˜ ìš°ì£¼ ìƒí–¥ ì ì¤‘! ì„œë¥˜ì™€ ë©´ì ‘/ë…¼ìˆ ë¡œ ë¶€ì¡±í•œ ë‚´ì‹ ì„ ì™„ë²½íˆ ë’¤ì§‘ì–´ì—ì—ˆìŠµë‹ˆë‹¤."; }
                else if (diff >= 0.15) { grade = 'S'; score = 95; comment = "ìƒí–¥ ì§€ì› ì„±ê³µ! ì¹˜ë°€í•œ ì „ëµê³¼ ë…¸ë ¥ì´ ë¹›ì„ ë°œí•œ ìµœê³ ì˜ ì…ì‹œì…ë‹ˆë‹¤."; }
                else if (diff >= -0.15) { grade = 'A'; score = 85; comment = "ì ì • ì§€ì› í•©ê²©! í”ë“¤ë¦¼ ì—†ì´ ìì‹ ì˜ ì‹¤ë ¥ë§Œí¼ í›Œë¥­í•˜ê²Œ ì§„í•™í–ˆìŠµë‹ˆë‹¤."; }
                else if (diff >= -0.4) { grade = 'B'; score = 75; comment = "ì•ˆì • ì§€ì› í•©ê²©. ë°œ ë»—ê³  ì˜ ìˆ˜ ìˆëŠ” í¸ì•ˆí•œ ì§€ì›ì´ì§€ë§Œ ì•½ê°„ ì•„ì‰¬ì›€ì€ ë‚¨ë„¤ìš”."; }
                else { grade = 'C'; score = 60; comment = "í•˜í–¥ ì§€ì› í•©ê²©! ê·¹ë‹¨ì ì¸ ì•ˆì • ì§€ì›ì…ë‹ˆë‹¤. ì´ë¥¸ë°” ìˆ˜ì‹œ ë‚©ì¹˜ê°€ ì˜ì‹¬ë©ë‹ˆë‹¤..?!"; }
            } else { // ì •ì‹œ
                // ìˆ˜ëŠ¥ì€ ë†’ì„ìˆ˜ë¡(ìˆ«ìê°€ í´ìˆ˜ë¡) ì„±ì ì´ ì¢‹ì€ ê²ƒ.
                // diffê°€ ì–‘ìˆ˜ë©´ ëŒ€í•™ ì»·ì´ ë‚´ ì ìˆ˜ë³´ë‹¤ ë†’ì€ë° í•©ê²©í•œ ê²ƒ -> ìŠ¤ë‚˜ì´í•‘
                diff = univ.jeongsi_cut - player.sat; 
                
                if (diff >= 4) { grade = 'S+'; score = 100; comment = "ê¸°ì ì˜ ìŠ¤ë‚˜ì´í•‘ ì„±ê³µ! ì´ë¥¸ë°” ì›ì„œ ì˜ì—­ 1ë“±ê¸‰ì´ ê°•ë¦¼í–ˆìŠµë‹ˆë‹¤."; }
                else if (diff >= 1) { grade = 'S'; score = 95; comment = "ì†Œì‹  ì§€ì› ì ì¤‘! í›Œë¥­í•œ ì›ì„œ ì¡°í•©ê³¼ ëˆˆì¹˜ì‹¸ì›€ì˜ ìŠ¹ë¦¬ì…ë‹ˆë‹¤."; }
                else if (diff >= -2) { grade = 'A'; score = 85; comment = "ì ì • ì§€ì› í•©ê²©! ìì‹ ì˜ ìˆ˜ëŠ¥ ì ìˆ˜ì— ë”± ë§ëŠ” í•©ë¦¬ì ì¸ ì§„í•™ì…ë‹ˆë‹¤."; }
                else if (diff >= -5) { grade = 'B'; score = 75; comment = "ì•ˆì • ì§€ì› í•©ê²©. ë¬´ë‚œí•˜ê²Œ ëŒ€í•™ ë¬¸ì„ í†µê³¼í–ˆìŠµë‹ˆë‹¤."; }
                else { grade = 'C'; score = 60; comment = "í•˜í–¥ ì§€ì› í•©ê²©. ìˆ˜ëŠ¥ ì ìˆ˜ê°€ ë„ˆë¬´ ì•„ê¹ìŠµë‹ˆë‹¤! ì¥í•™ê¸ˆì€ ë°›ìœ¼ì…¨ê² ì£ ?"; }
            }

            const gradeEl = document.getElementById('eval-grade');
            gradeEl.innerText = grade;
            gradeEl.className = "text-6xl font-black drop-shadow-md w-24 text-center " + 
                (grade.includes('S') ? 'text-red-500' : (grade === 'A' ? 'text-blue-500' : (grade === 'B' ? 'text-green-500' : 'text-slate-500')));

            document.getElementById('eval-score').innerText = `ì…ì‹œ ìŠ¤ì½”ì–´: ${score}ì `;
            document.getElementById('eval-comment').innerText = comment;
        }

        window.showEncouragementLetter = function(isPass) {
            window.switchScene('scene-letter');
            
            const letterContent = document.getElementById('letter-content');
            if (isPass || passedUniversities.length > 0) {
                letterContent.innerHTML = `
                    <p class="mb-6 font-bold text-3xl text-indigo-600">ì‚¬ë‘í•˜ëŠ” ìˆ˜í—˜ìƒ ì—¬ëŸ¬ë¶„ê»˜,</p>
                    <p class="mb-4">ê¸´ ì‹œê°„ ë¬µë¬µíˆ ë‹¬ë ¤ì˜¤ëŠë¼ ì •ë§ ê³ ìƒ ë§ì•˜ìŠµë‹ˆë‹¤. ì…ì‹œë¼ëŠ” í° ì‚°ì„ ë„˜ì€ ë„¤ê°€ ì„ ìƒë‹˜ì€ ì°¸ ëŒ€ê²¬í•˜ê³  ìë‘ìŠ¤ëŸ½ë‹¨ë‹¤.</p>
                    <p class="mb-4">í•©ê²©ì€ ì¢…ì°©ì—­ì´ ì•„ë‹ˆë¼ ìƒˆë¡œìš´ ì¶œë°œì„ ì´ë¼ëŠ” ê±¸ ìŠì§€ ë§ˆ. ëŒ€í•™ì´ë¼ëŠ” ê³³ì€ ì •ë‹µì´ ì •í•´ì§„ ê³µë¶€ê°€ ì•„ë‹ˆë¼, ë„¤ê°€ ì§„ì§œ ì¢‹ì•„í•˜ëŠ” ê²ƒì´ ë¬´ì—‡ì¸ì§€ ì°¾ì•„ê°€ëŠ” ê³³ì´ì•¼. ì§€ê¸ˆê¹Œì§€ ë³´ì—¬ì¤€ ì„±ì‹¤í•¨ì— ìœ ì—°í•œ ì‚¬ê³ ê¹Œì§€ ë”í•´ì§„ë‹¤ë©´, ë„ˆëŠ” ë¶„ëª… ë” ë©‹ì§„ ì–´ë¥¸ìœ¼ë¡œ ì„±ì¥í•  ê±°ì•¼.</p>
                    <p class="mb-8">ì£¼ë³€ì— í˜¹ì‹œ ë§ˆìŒ ì•„íŒŒí•˜ëŠ” ì¹œêµ¬ë“¤ì´ ìˆë‹¤ë©´ ë”°ëœ»í•œ ë°°ë ¤ë„ ìŠì§€ ì•ŠëŠ” ë©‹ì§„ ì„ ë°°ê°€ ë˜ê¸¸ ë°”ë€ë‹¤. ì •ë§ ìˆ˜ê³  ë§ì•˜ë‹¤!</p>
                    <p class="text-right font-bold text-pink-500 text-xl">- NADASHIP ë“œë¦¼ -</p>
                `;
            } else {
                letterContent.innerHTML = `
                    <p class="mb-6 font-bold text-3xl text-indigo-600">ì‚¬ë‘í•˜ëŠ” ìˆ˜í—˜ìƒ ì—¬ëŸ¬ë¶„ê»˜,</p>
                    <p class="mb-4">ì§€ê¸ˆì€ ì–´ë–¤ ë§ë„ ë“¤ë¦¬ì§€ ì•Šê² ì§€ë§Œ, ê¼­ í•´ì£¼ê³  ì‹¶ì€ ë§ì´ ìˆì–´. ì´ë²ˆ ê²°ê³¼ê°€ ê²°ì½” 'ë„ˆë¼ëŠ” ì‚¬ëŒ'ì˜ ê°€ì¹˜ë¥¼ ì¦ëª…í•˜ëŠ” ì§€í‘œëŠ” ì•„ë‹ˆë¼ëŠ” ê±°ì•¼.</p>
                    <p class="mb-4">ì¸ìƒì´ë¼ëŠ” ê¸´ ë§ˆë¼í†¤ì—ì„œ ì§€ê¸ˆì€ ì ì‹œ ëŒë¶€ë¦¬ì— ê±¸ë ¤ ë„˜ì–´ì§„ ê²ƒë¿ì´ì§€, ë„¤ê°€ ê°€ì§„ ë‹¬ë¦¬ê¸° ì‹¤ë ¥ì´ ì—†ì–´ì§„ ê²Œ ì•„ë‹ˆê±°ë“ . ì ì‹œ ë§ˆìŒì„ ì¶”ìŠ¤ë¥´ê³  ë‚˜ë©´, ë„ˆëŠ” ë¶„ëª… ë” ë‹¨ë‹¨í•´ì§„ ëª¨ìŠµìœ¼ë¡œ ì¼ì–´ì„¤ ê±°ì•¼.</p>
                    <p class="mb-8">ì„ ìƒë‹˜ì€ ì–¸ì œë‚˜ ì—¬ê¸°ì„œ ë„¤ ê°€ëŠ¥ì„±ì„ ë¯¿ê³  ì‘ì›í• ê²Œ. ê³ ìƒ ë§ì•˜ë‹¤.</p>
                    <p class="text-right font-bold text-pink-500 text-xl">- NADASHIP ë“œë¦¼ -</p>
                `;
            }
            window.calculateHallOfFame();
        };

        window.calculateHallOfFame = function() {
            let title = "ëœ¨ê±°ìš´ ë„ì „ì";
            let icon = "ğŸƒ";
            let comment = "ëê¹Œì§€ í¬ê¸°í•˜ì§€ ì•Šì€ ë‹¹ì‹ ì˜ ë…¸ë ¥ì— ë°•ìˆ˜ë¥¼ ë³´ëƒ…ë‹ˆë‹¤!";
            let bestUni = "ì§„í•™ í¬ê¸° (ì¬ë„ì „)";
            let baseScore = 0;
            
            if (selectedFinalUniversity) {
                bestUni = selectedFinalUniversity.name;
                const tier = selectedFinalUniversity.tier;
                let isUpgarde = false; 
                
                if (tier === 'medical') baseScore = 100;
                else if (tier === 'sky') baseScore = 95;
                else if (tier === 'in_seoul_top') baseScore = 90;
                else if (tier === 'in_seoul_mid') baseScore = 85;
                else if (tier === 'jigeoguk') baseScore = 85;
                else if (tier === 'metro') baseScore = 80;
                else baseScore = 75;

                // ìƒí–¥ ì§€ì› ë³´ë„ˆìŠ¤
                if (selectedFinalUniversity.method === 'ìˆ˜ì‹œ') {
                    let cut = (player.track === 'ìì—°' || player.track === 'ì˜í•™') ? selectedFinalUniversity.cut_n : selectedFinalUniversity.cut_h;
                    if (player.track === 'ì˜ˆì²´ëŠ¥') cut += 1.0;
                    if (player.gpa - cut > 0.2) { baseScore += 5; isUpgarde = true; } 
                } else {
                    if (selectedFinalUniversity.jeongsi_cut - player.sat > 2) { baseScore += 5; isUpgarde = true; } 
                }
            }

            // íŒŒì´ì–´ë² ì´ìŠ¤(Firestore)ë¥¼ í†µí•œ ì˜¨ë¼ì¸ ë­í‚¹ ì €ì¥ ë¡œì§
            if (!isRecordSaved && player.name && window.currentUser && window.db && window.addDoc) {
                const record = {
                    name: player.name,
                    uni: bestUni,
                    gpa: player.gpa.toFixed(2),
                    sat: player.sat,
                    score: baseScore,
                    date: new Date().toLocaleDateString(),
                    timestamp: Date.now()
                };
                
                // Firestoreì— ë°ì´í„° ì „ì†¡
                const hofRef = window.collection(window.db, 'artifacts', window.appId, 'public', 'data', 'hall_of_fame');
                window.addDoc(hofRef, record).catch(e => console.error("ê¸°ë¡ ì €ì¥ ì‹¤íŒ¨", e));
                isRecordSaved = true;

                // ì¦‰ê°ì ì¸ í”¼ë“œë°±ì„ ìœ„í•´ ë¡œì»¬ ë³€ìˆ˜(globalHofData)ì— ì„ì‹œ ì¶”ê°€ ë° ìˆœìœ„ ê³„ì‚°
                let tempHofData = [...(window.globalHofData || [])];
                tempHofData.push(record);
                tempHofData.sort((a, b) => b.score - a.score || b.timestamp - a.timestamp);
                
                let currentRank = tempHofData.findIndex(r => r.timestamp === record.timestamp) + 1;
                
                if (currentRank === 1) {
                    title = "ì…ì‹œì˜ ì‹ "; icon = "ğŸ‘‘";
                    comment = "ì „ì²´ ëˆ„ì  ë­í‚¹ 1ìœ„! ìˆ˜ë§ì€ ê²½ìŸìë¥¼ ëš«ê³  ì…ì‹œíŒì„ ì™„ë²½íˆ í‰ì •í–ˆìŠµë‹ˆë‹¤!";
                } else if (currentRank === 2) {
                    title = "ì…ì‹œì˜ ê³ ìˆ˜"; icon = "ğŸŒŸ";
                    comment = "ì „ì²´ ë­í‚¹ 2ìœ„ ë‹¬ì„±! ë‹¹ì‹ ì˜ ì² ì €í•œ ì…ì‹œ ì „ëµì€ ì§„ì •í•œ ê³ ìˆ˜ì˜ ë°˜ì—´ì— ì˜¬ëìŠµë‹ˆë‹¤!";
                } else if (currentRank === 3) {
                    title = "ì…ì‹œ í”„ë¡œ"; icon = "ğŸ‘";
                    comment = "ì˜ê´‘ì˜ 3ìœ„ê¶Œ ì§„ì… ì„±ê³µ! ë‹¹ì‹ ì˜ ì§‘ë…ê³¼ ë¶„ì„ë ¥ì€ ì™„ì „íˆ í”„ë¡œ ìˆ˜ì¤€ì…ë‹ˆë‹¤.";
                } else {
                    comment = `í˜„ì¬ í†µí•© ë­í‚¹ ${currentRank}ìœ„! ëê¹Œì§€ í¬ê¸°í•˜ì§€ ì•Šì€ ëœ¨ê±°ìš´ ë„ì „ì— í° ë°•ìˆ˜ë¥¼ ë³´ëƒ…ë‹ˆë‹¤!`;
                }

                document.getElementById('hof-title').innerText = title;
                document.getElementById('hof-icon').innerText = icon;
                document.getElementById('hof-comment').innerText = comment;
            } else if (!window.db) {
                // íŒŒì´ì–´ë² ì´ìŠ¤ ë¯¸ì—°ê²° ì‹œ ë¡œì»¬ fallback ì•ˆë‚´
                document.getElementById('hof-title').innerText = title;
                document.getElementById('hof-icon').innerText = icon;
                document.getElementById('hof-comment').innerText = "(ì˜¤í”„ë¼ì¸ ëª¨ë“œ) " + comment;
            }

            document.getElementById('hof-name').innerText = player.name;
            document.getElementById('hof-uni').innerText = bestUni;
            document.getElementById('hof-gpa').innerText = player.gpa.toFixed(2);
            document.getElementById('hof-sat').innerText = player.sat;
        }

        window.openHallOfFameModal = function() {
            const modal = document.getElementById('hof-modal');
            const container = document.getElementById('hof-list-container');
            modal.classList.remove('hidden');
            
            window.renderHallOfFameList();
        }

        window.renderHallOfFameList = function() {
            const container = document.getElementById('hof-list-container');
            let hofData = window.globalHofData || [];
            
            if(hofData.length === 0) {
                container.innerHTML = '<div class="text-slate-400 text-center mt-12 font-game text-xl">ì•„ì§ ë“±ë¡ëœ ì…ì‹œ ê¸°ë¡ì´ ì—†ê±°ë‚˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤.<br><br>ì²« ë²ˆì§¸ ë­ì»¤ì— ë„ì „í•˜ì„¸ìš”!</div>';
                return;
            }
            
            container.innerHTML = hofData.map((data, index) => {
                let rankColor = 'text-slate-500';
                let dynamicTitle = "ëœ¨ê±°ìš´ ë„ì „ì";
                let dynamicIcon = "ğŸƒ";

                if(index === 0) { rankColor = 'text-yellow-400 drop-shadow-[0_0_8px_rgba(250,204,21,0.8)]'; dynamicTitle = "ì…ì‹œì˜ ì‹ "; dynamicIcon = "ğŸ‘‘"; }
                else if(index === 1) { rankColor = 'text-gray-300 drop-shadow-[0_0_8px_rgba(209,213,219,0.8)]'; dynamicTitle = "ì…ì‹œì˜ ê³ ìˆ˜"; dynamicIcon = "ğŸŒŸ"; }
                else if(index === 2) { rankColor = 'text-amber-600 drop-shadow-[0_0_8px_rgba(217,119,6,0.8)]'; dynamicTitle = "ì…ì‹œ í”„ë¡œ"; dynamicIcon = "ğŸ‘"; }

                return `
                <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 mb-3 flex items-center gap-3 md:gap-5 transform transition hover:scale-[1.02]">
                    <div class="text-3xl font-black ${rankColor} w-8 md:w-10 text-center font-game">${index + 1}</div>
                    <div class="text-4xl filter drop-shadow-md">${dynamicIcon}</div>
                    <div class="flex-grow">
                        <div class="text-yellow-300 font-bold text-xs md:text-sm font-game tracking-wider">${dynamicTitle}</div>
                        <div class="text-white font-bold text-lg md:text-2xl font-game">${data.name} <span class="text-xs text-slate-400 font-sans font-normal ml-1 md:ml-2">${data.date}</span></div>
                        <div class="text-cyan-300 text-sm md:text-base font-bold font-game mt-1 truncate max-w-[150px] md:max-w-[300px]">${data.uni}</div>
                    </div>
                    <div class="text-right text-xs md:text-sm font-game bg-slate-900 p-2 md:p-3 rounded-lg border border-slate-600 min-w-[70px]">
                        <div class="text-green-400 mb-1">ë‚´ì‹  ${data.gpa}</div>
                        <div class="text-purple-400">ìˆ˜ëŠ¥ ${data.sat}%</div>
                    </div>
                </div>
                `;
            }).join('');
        }

        window.closeHallOfFameModal = function() {
            document.getElementById('hof-modal').classList.add('hidden');
        }

        // --- ê´€ë¦¬ì ëª¨ë‹¬ ë° ì´ˆê¸°í™” ë¡œì§ ---
        window.openAdminModal = function() {
            document.getElementById('admin-id').value = '';
            document.getElementById('admin-pw').value = '';
            document.getElementById('admin-modal').classList.remove('hidden');
        }

        window.closeAdminModal = function() {
            document.getElementById('admin-modal').classList.add('hidden');
        }

        window.executeAdminClear = async function() {
            const id = document.getElementById('admin-id').value;
            const pw = document.getElementById('admin-pw').value;
            
            if(id === '1234' && pw === '1234') {
                const btn = document.querySelector('#admin-modal button');
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ì´ˆê¸°í™” ì¤‘...';
                btn.disabled = true;

                if(window.db && window.deleteDoc && window.doc) {
                    try {
                        const promises = window.globalHofData.map(record => {
                            return window.deleteDoc(window.doc(window.db, 'artifacts', window.appId, 'public', 'data', 'hall_of_fame', record.dbId));
                        });
                        
                        await Promise.all(promises);
                        
                        window.globalHofData = [];
                        window.renderHallOfFameList();
                        
                        btn.innerHTML = '<i class="fas fa-check"></i> ì´ˆê¸°í™” ì™„ë£Œ';
                        setTimeout(() => {
                            window.closeAdminModal();
                            btn.disabled = false;
                            btn.innerHTML = '<i class="fas fa-trash-alt"></i> ì „ì²´ ì´ˆê¸°í™” ì‹¤í–‰';
                        }, 1000);
                        
                    } catch(e) {
                        alert("ì´ˆê¸°í™” ì¤‘ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                        console.error(e);
                        btn.disabled = false;
                        btn.innerHTML = '<i class="fas fa-trash-alt"></i> ì „ì²´ ì´ˆê¸°í™” ì‹¤í–‰';
                    }
                } else {
                    alert("ë°ì´í„°ë² ì´ìŠ¤ê°€ ì—°ê²°ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-trash-alt"></i> ì „ì²´ ì´ˆê¸°í™” ì‹¤í–‰';
                }
            } else {
                // ì»¤ìŠ¤í…€ ì•Œë¦¼ ì²˜ë¦¬
                const idInput = document.getElementById('admin-id');
                const pwInput = document.getElementById('admin-pw');
                idInput.classList.add('border-red-500', 'shake');
                pwInput.classList.add('border-red-500', 'shake');
                
                setTimeout(() => {
                    idInput.classList.remove('shake');
                    pwInput.classList.remove('shake');
                }, 500);
            }
        }

    </script>
</body>
</html>
